---
title: CLR をターゲットにした C++/CLI プログラムをコンパイルする
description: Microsoft C++ を使用して、ネイティブ C++ コードと .NET プログラムを接続できるプログラムおよびライブラリを作成します。
ms.date: 04/23/2019
helpviewer_keywords:
- command-line applications [C++], managed code
- compiling programs [C++]
- Visual C++, managed code
- managed code [C++]
ms.assetid: 339f89df-a5d2-4040-831a-ddbe25b5dce4
ms.openlocfilehash: d6d06104cc007ae5ff20f579225c885690a704e4
ms.sourcegitcommit: 9c2b3df9b837879cd17932ae9f61cdd142078260
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 10/29/2020
ms.locfileid: "92924214"
---
# <a name="walkthrough-compile-a-ccli-program-that-targets-the-clr-in-visual-studio"></a>チュートリアル: Visual Studio で CLR を対象とする C++/CLI プログラムをコンパイルする

C++/CLI を使用すると、.NET クラスとネイティブ C++ 型を使用する C++ プログラムを作成できます。 C++/CLI は、ネイティブ C++ コードをラップし、.NET プログラムからアクセスできるようにする、コンソールアプリケーションおよび Dll で使用することを目的としています。 .NET に基づく Windows ユーザーインターフェイスを作成するには、C# または Visual Basic を使用します。

この手順では、独自の C++ プログラムを入力するか、サンプルプログラムのいずれかを使用できます。 この手順で使用するサンプル プログラムでは、textfile.txt という名前のテキスト ファイルを作成し、プロジェクト ディレクトリに保存します。

## <a name="prerequisites"></a>必須コンポーネント

- C++ 言語の基本の理解。
- Visual Studio 2017 以降では、C++/CLI のサポートはオプションのコンポーネントです。 インストールするには、Windows の [スタート] メニューから **Visual Studio インストーラー** を開きます。 [ **C++ を使用したデスクトップ開発** ] タイルがオンになっていることを確認し、[ **オプション** コンポーネント] セクションで、[ **c++/cli サポート** ] もオンにします。

## <a name="create-a-new-project"></a>新しいプロジェクトを作成する

次の手順は、使っている Visual Studio のバージョンによって異なります。 優先するバージョンの Visual Studio のドキュメントを表示するには、 **[バージョン]** セレクター コントロールを使用します。 このページの目次の一番上にあります。

::: moniker range="msvc-160"

### <a name="to-create-a-ccli-project-in-visual-studio-2019"></a>Visual Studio 2019 で C++/CLI プロジェクトを作成するには

1. **ソリューションエクスプローラー** で、上部を右クリックして [ **新しいプロジェクトの作成** ] ダイアログボックスを開きます。

1. ダイアログの上部にある検索ボックスに「 **clr** 」と入力し、結果の一覧から [ **clr Empty Project** ] を選択します。

1. **[作成]** ボタンをクリックしてプロジェクトを作成します。

::: moniker-end

::: moniker range="msvc-150"

### <a name="to-create-a-ccli-project-in-visual-studio-2017"></a>Visual Studio 2017 で C++/CLI プロジェクトを作成するには

1. 新しいプロジェクトを作成します。 **[ファイル]** メニューの **[新規作成]** をポイントし、 **[プロジェクト]** をクリックします。

1. Visual C++ プロジェクトの種類から、 **[CLR]** 、 **[CLR 空プロジェクト]** の順にクリックします。

1. プロジェクト名を入力します。 既定では、プロジェクトを含むソリューションは新しいプロジェクトと同じ名前になりますが、別の名前を入力してもかまいません。 必要に応じて、プロジェクトの場所として別の場所を入力することもできます。

1. **[OK]** をクリックして、新しいプロジェクトを作成します。

::: moniker-end

::: moniker range="msvc-140"

### <a name="to-create-a-ccli-project-in-visual-studio-2015"></a>Visual Studio 2015 で C++/CLI プロジェクトを作成するには

1. 新しいプロジェクトを作成します。 **[ファイル]** メニューの **[新規作成]** をポイントし、 **[プロジェクト]** をクリックします。

1. Visual C++ プロジェクトの種類から、 **[CLR]** 、 **[CLR 空プロジェクト]** の順にクリックします。

1. プロジェクト名を入力します。 既定では、プロジェクトを含むソリューションは新しいプロジェクトと同じ名前になりますが、別の名前を入力してもかまいません。 必要に応じて、プロジェクトの場所として別の場所を入力することもできます。

1. **[OK]** をクリックして、新しいプロジェクトを作成します。

::: moniker-end

## <a name="add-a-source-file"></a>ソースファイルの追加

1. **ソリューション エクスプローラー** が表示されていない場合は、 **[表示]** メニューの **[ソリューション エクスプローラー]** をクリックします。

1. プロジェクトに新しいソース ファイルを追加します。

   - **ソリューションエクスプローラー** で [ **ソースファイル** ] フォルダーを右クリックし、[ **追加** ] をポイントして、[ **新しい項目** ] をクリックします。

   - **[C++ ファイル (.cpp)]** をクリックしてファイル名を入力し、 **[追加]** をクリックします。

   **.Cpp** ファイルが **ソリューションエクスプローラー** の [ **ソースファイル** ] フォルダーに表示され、そのファイルに必要なコードを入力するタブ付きウィンドウが表示されます。

1. Visual Studio で新しく作成されたタブをクリックして、有効な Visual C++ プログラムを入力するか、サンプル プログラムのいずれかをコピーして貼り付けます。

   たとえば、(プログラミング ガイドの **ファイル処理と I/O** ノード内の) 「 [方法: テキスト ファイルを記述する (C++/CLI)](./file-handling-and-i-o-cpp-cli.md#write_text)」サンプル プログラムを使用できます。

   サンプルプログラムを使用する場合は、 **`gcnew`** .net オブジェクトを作成するときにの代わりにキーワードを使用 **`new`** し、 **`gcnew`** `^` ポインター () ではなくハンドル () を返すことに注意して `*` ください。

   `StreamWriter^ sw = gcnew StreamWriter(fileName);`

   C++/CLI 構文の詳細については、「 [ランタイムプラットフォームのコンポーネント拡張](../extensions/component-extensions-for-runtime-platforms.md)」を参照してください。

1. **[ビルド]** メニューの **[ソリューションのビルド]** をクリックします。

   **[出力]** ウィンドウに、ビルド ログの場所やビルドの状態を示すメッセージなど、コンパイルの進行状況に関する情報が表示されます。

   ビルドを行わずに、プログラムを変更して実行する場合、ダイアログ ボックスにプロジェクトが有効期限切れであることが示される場合があります。 Visual Studio がアプリケーションをビルドするたびに入力を求めるのではなく、常にファイルの現在のバージョンを使用するようにする場合は、このダイアログでチェック ボックスを選択してから **[OK]** をクリックします。

1. [ **デバッグ** ] メニューの [ **デバッグなしで開始** ] をクリックします。

1. サンプル プログラムを使用した場合は、プログラムを実行するときに、テキスト ファイルが作成されたことを示すコマンド ウィンドウが表示されます。

   これで **textfile.txt** テキスト ファイルがプロジェクトに配置されました。 このファイルはメモ帳を使用して開くことができます。

   > [!NOTE]
   > 空の CLR プロジェクト テンプレートを選択すると、`/clr` コンパイラ オプションが自動的に設定されます。 これを確認するには、 **ソリューション エクスプローラー** でプロジェクトを右クリックして、 **[プロパティ]** をクリックしてから、 **[構成プロパティ]** の **[全般]** ノードで **[共通言語ランタイム サポート]** オプションを確認します。

## <a name="see-also"></a>関連項目

[C++ 言語リファレンス](../cpp/cpp-language-reference.md)<br/>
[プロジェクトおよびビルド システム](../build/projects-and-build-systems-cpp.md)<br/>
