---
title: CLR をC++対象とする/cli プログラムをコンパイルする
description: Microsoft C++を使用して、ネイティブC++コードと .net プログラムに接続できるプログラムとライブラリを作成します。
ms.date: 04/23/2019
helpviewer_keywords:
- command-line applications [C++], managed code
- compiling programs [C++]
- Visual C++, managed code
- managed code [C++]
ms.assetid: 339f89df-a5d2-4040-831a-ddbe25b5dce4
ms.openlocfilehash: 36c41856dfcdb5c5f50ba59205b4c73c5fde5963
ms.sourcegitcommit: 8e285a766523e653aeeb34d412dc6f615ef7b17b
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/21/2020
ms.locfileid: "80080019"
---
# <a name="walkthrough-compile-a-ccli-program-that-targets-the-clr-in-visual-studio"></a>チュートリアル: Visual Studio C++で CLR を対象とする/cli プログラムをコンパイルする

/Cli をC++使用すると、 C++ネイティブC++型と同様に、.net クラスを使用するプログラムを作成できます。 C++/CLI は、ネイティブC++コードをラップし、.net プログラムからアクセスできるようにする、コンソールアプリケーションおよび dll で使用することを目的としています。 .NET に基づく Windows ユーザーインターフェイスを作成するにはC# 、または Visual Basic を使用します。

この手順では、独自C++のプログラムを入力するか、サンプルプログラムのいずれかを使用できます。 この手順で使用するサンプル プログラムでは、textfile.txt という名前のテキスト ファイルを作成し、プロジェクト ディレクトリに保存します。

## <a name="prerequisites"></a>前提条件

- C++ 言語の基本の理解。
- Visual Studio 2017 以降では、 C++/cli のサポートはオプションのコンポーネントです。 インストールするには、Windows の [スタート] メニューから**Visual Studio インストーラー**を開きます。 **[デスクトップ開発C++ ]** タイルがオンになっていることを確認し、 **[オプション]** コンポーネント セクションで、 **[ C++/cli サポート]** もオンにします。

## <a name="create-a-new-project"></a>新しいプロジェクトを作成する

次の手順は、使っている Visual Studio のバージョンによって異なります。 このページの左上にあるバージョン セレクターが適切に設定されていることを確認してください。

::: moniker range="vs-2019"

### <a name="to-create-a-ccli-project-in-visual-studio-2019"></a>Visual Studio 2019 C++で/cli プロジェクトを作成するには

1. **ソリューションエクスプローラー**で、上部を右クリックして **[新しいプロジェクトの作成]** ダイアログボックスを開きます。

1. ダイアログの上部にある検索ボックスに「 **clr** 」と入力し、結果の一覧から **[clr Empty Project]** を選択します。

1. **[作成]** ボタンをクリックしてプロジェクトを作成します。

::: moniker-end

::: moniker range="vs-2017"

### <a name="to-create-a-ccli-project-in-visual-studio-2017"></a>Visual Studio 2017 C++で/cli プロジェクトを作成するには

1. 新しいプロジェクトを作成します。 **[ファイル]** メニューの **[新規作成]** をポイントし、 **[プロジェクト]** をクリックします。

1. Visual C++ プロジェクトの種類から、 **[CLR]** 、 **[CLR 空プロジェクト]** の順にクリックします。

1. プロジェクト名を入力します。 既定では、プロジェクトを含むソリューションは新しいプロジェクトと同じ名前になりますが、別の名前を入力してもかまいません。 必要に応じて、プロジェクトの場所として別の場所を入力することもできます。

1. **[OK]** をクリックして、新しいプロジェクトを作成します。

::: moniker-end

::: moniker range="vs-2015"

### <a name="to-create-a-ccli-project-in-visual-studio-2015"></a>Visual Studio 2015 C++で/cli プロジェクトを作成するには

1. 新しいプロジェクトを作成します。 **[ファイル]** メニューの **[新規作成]** をポイントし、 **[プロジェクト]** をクリックします。

1. Visual C++ プロジェクトの種類から、 **[CLR]** 、 **[CLR 空プロジェクト]** の順にクリックします。

1. プロジェクト名を入力します。 既定では、プロジェクトを含むソリューションは新しいプロジェクトと同じ名前になりますが、別の名前を入力してもかまいません。 必要に応じて、プロジェクトの場所として別の場所を入力することもできます。

1. **[OK]** をクリックして、新しいプロジェクトを作成します。

::: moniker-end

## <a name="add-a-source-file"></a>ソースファイルの追加

1. **ソリューション エクスプローラー**が表示されていない場合は、 **[表示]** メニューの **[ソリューション エクスプローラー]** をクリックします。

1. プロジェクトに新しいソース ファイルを追加します。

   - **ソリューション エクスプローラー**で、 **[ソース ファイル]** フォルダーを右クリックし、 **[追加]** をポイントして、 **[新しい項目]** をクリックします。

   - **[C++ ファイル (.cpp)]** をクリックしてファイル名を入力し、 **[追加]** をクリックします。

   **ソリューション エクスプローラー**の**ソース ファイル** フォルダーに **.cpp** ファイルが表示されます。また、タブ付きウィンドウが表示され、ここでそのファイル内に含めるコードを入力します。

1. Visual Studio で新しく作成されたタブをクリックして、有効な Visual C++ プログラムを入力するか、サンプル プログラムのいずれかをコピーして貼り付けます。

   たとえば、(プログラミング ガイドの[ファイル処理と I/O](how-to-write-a-text-file-cpp-cli.md) ノード内の) 「**方法: テキスト ファイルを記述する (C++/CLI)** 」サンプル プログラムを使用できます。

   サンプル プログラムを使用する場合は、.NET オブジェクトを作成するときに、`gcnew` の代わりに `new`キーワードを使用することと、`gcnew` がポインター (`^`) ではなくハンドル (`*`) を返すことに注意してください。

   `StreamWriter^ sw = gcnew StreamWriter(fileName);`

   /Cli 構文のC++詳細については、「[ランタイムプラットフォームのコンポーネント拡張](../extensions/component-extensions-for-runtime-platforms.md)」を参照してください。

1. **[ビルド]** メニューの **[ソリューションのビルド]** をクリックします。

   **[出力]** ウィンドウに、ビルド ログの場所やビルドの状態を示すメッセージなど、コンパイルの進行状況に関する情報が表示されます。

   ビルドを行わずに、プログラムを変更して実行する場合、ダイアログ ボックスにプロジェクトが有効期限切れであることが示される場合があります。 Visual Studio がアプリケーションをビルドするたびに入力を求めるのではなく、常にファイルの現在のバージョンを使用するようにする場合は、このダイアログでチェック ボックスを選択してから **[OK]** をクリックします。

1. **[デバッグ]** メニューの **[デバッグなしで開始]** をクリックします。

1. サンプル プログラムを使用した場合は、プログラムを実行するときに、テキスト ファイルが作成されたことを示すコマンド ウィンドウが表示されます。

   これで **textfile.txt** テキスト ファイルがプロジェクトに配置されました。 このファイルはメモ帳を使用して開くことができます。

   > [!NOTE]
   > 空の CLR プロジェクト テンプレートを選択すると、`/clr` コンパイラ オプションが自動的に設定されます。 これを確認するには、**ソリューション エクスプローラー**でプロジェクトを右クリックして、 **[プロパティ]** をクリックしてから、 **[構成プロパティ]** の **[全般]** ノードで **[共通言語ランタイム サポート]** オプションを確認します。

## <a name="see-also"></a>参照

[C++ 言語リファレンス](../cpp/cpp-language-reference.md)<br/>
[プロジェクトおよびビルド システム](../build/projects-and-build-systems-cpp.md)<br/>
