---
title: Visual Studio プロジェクトでのプロパティの継承 - C++
description: ネイティブ (MSBuild) Visual Studio C++ プロジェクトでのプロパティの継承のしくみ。
ms.date: 02/21/2020
helpviewer_keywords:
- C++ projects, property inheritance
ms.openlocfilehash: 4740c479c6cc7c877fd72b7828a8e4811826de6c
ms.sourcegitcommit: c123cc76bb2b6c5cde6f4c425ece420ac733bf70
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/14/2020
ms.locfileid: "81328476"
---
# <a name="property-inheritance-in-visual-studio-projects"></a>Visual Studio プロジェクトでのプロパティの継承

Visual Studio のネイティブ プロジェクト システムは、MSBuild に基づいています。 MSBuild では、あらゆる種類のプロジェクトをビルドするためのファイル形式と規則が定義されています。 これは複数の構成とプラットフォームについての複雑な構築の大部分を管理します。 このしくみを理解しておくと役立ちます。 これは特にカスタム構成を定義する場合に重要です。 または、共有して複数のプロジェクトにインポートできる、再利用可能なプロパティのセットを作成する場合も当てはまります。

## <a name="the-vcxproj-file-props-files-and-targets-files"></a>.vcxproj ファイル、.props ファイル、および .targets ファイル

プロジェクトのプロパティは、プロジェクト ファイル ( *`.vcxproj`* ) に直接格納されるか、またはプロジェクト ファイルによってインポートされる他の *`.targets`* または *`.props`* ファイルに格納されて、既定値を提供します。 Visual Studio 2015 では、これらのファイルは *`\Program Files (x86)\MSBuild\Microsoft.Cpp\v4.0\V140`* にあります。 Visual Studio 2017 では、これらのファイルは *`\Program Files (x86)\Microsoft Visual Studio\2017\<edition>\Common7\IDE\VC\VCTargets`* にあり、ここで *`<edition>`* はインストールされている Visual Studio のエディションです。 Visual Studio 2019 では、これらのファイルは *`\Program Files (x86)\Microsoft Visual Studio\2019\<edition>\MSBuild\Microsoft\VC\v160`* にあります。 プロパティは、独自のプロジェクトに追加されているすべてのカスタム *`.props`* ファイルにも格納されます。 これらのファイルは手動で編集しないことを強くお勧めします。 代わりに、MSBuild を深く理解していない限り、すべてのプロパティ (特に継承に関与するもの) の変更には IDE のプロパティ ページを使ってください。

前に示したように、同じ構成の同じプロパティに対し、これらの異なるファイルで異なる値を割り当てることができます。 プロジェクトをビルドするとき、MSBuild エンジンは、プロジェクト ファイルとすべてのインポートされたファイルを、適切に定義された順序 (後述) で評価します。 各ファイルが評価されると、そのファイルで定義されているすべてのプロパティ値が、既存の値をオーバーライドします。 指定されていない値は、前に評価されたファイルから継承されます。 プロパティ ページでプロパティを設定するときは、それを設定する場所にも注意を払うことが重要です。 あるプロパティを *`.props`* ファイルで "X" に設定しても、プロジェクト ファイルでそのプロパティが "Y" に設定されている場合、プロジェクトは "Y" に設定されたプロパティでビルドされます。 同じプロパティが *`.cpp`* ファイルなどのプロジェクト項目で "Z" に設定されている場合、MSBuild エンジンは値 "Z" を使います。

基本的な継承ツリーを次に示します。

1. MSBuild CPP ツールセットの既定の設定 ( *`.vcxproj`* ファイルによってインポートされる ..\Program Files\MSBuild\Microsoft.Cpp\v4.0\Microsoft.Cpp.Default.props)

1. プロパティ シート

1. *`.vcxproj`* ファイル。 (既定値とプロパティ シートの設定をオーバーライド可能)。

1. 項目メタデータ

> [!TIP]
> プロパティ ページで、**太字**のプロパティは、現在のコンテキストで定義されます。 通常フォントのプロパティが継承されます。

## <a name="view-an-expanded-project-file-with-all-imported-values"></a>インポートされたすべての値を含む展開されたプロジェクト ファイルを表示する

指定したプロパティ値がどのように継承されているかを特定するために、拡張されたファイルを表示すると便利な場合があります。 拡張されたバージョンを表示するには、Visual Studio コマンド プロンプトで次のコマンドを入力します (プレースホルダー ファイル名を適宜変更してください)。

> **msbuild /pp:** _temp_ **.txt** _myapp_ **.vcxproj**

拡張されたプロジェクト ファイルは大きく、MSBuild に詳しくない場合は理解するのが難しい可能性があります。 プロジェクト ファイルの基本的な構造を次に示します。

1. IDE では公開されていない基本的なプロジェクトのプロパティ。

1. ツールセットに依存しない一部の基本的なプロパティを定義する *`Microsoft.cpp.default.props`* のインポート。

1. グローバル構成プロパティ ( **[Configuration General]\(構成概要\)** ページの **[PlatformToolset]** および **[プロジェクト]** 既定プロパティとして公開されます)。 これらのプロパティは、次の手順の *`Microsoft.cpp.props`* でインポートされるツールセットおよび組み込みプロパティ シートを決定します。

1. プロジェクトのほとんどの既定値を設定する *`Microsoft.cpp.props`* のインポート。

1. *`.user`* ファイルを含むすべてのプロパティ シートのインポート。 これらのプロパティ シートは、 **[PlatformToolset]** および **[プロジェクト]** の既定プロパティを除くすべてをオーバーライドできます。

1. プロジェクト構成プロパティの残り。 これらの値は、プロパティ シートの設定をオーバーライドできます。

1. 項目 (ファイル) とそのメタデータ。 これらの項目は、他のプロパティやインポートの前に発生した場合でも、常に MSBuild 評価規則の最後の単語です。

詳細については、「[MSBuild プロパティ](/visualstudio/msbuild/msbuild-properties)」を参照してください。

## <a name="build-configurations"></a>ビルドの構成

構成は、名前が与えられたプロパティの任意のグループでしかありません。 Visual Studio はデバッグとリリースの構成を提供します。 これらはそれぞれ、デバッグ ビルドまたはリリース ビルドのさまざまなプロパティを適切に設定します。 **構成マネージャー**を使用して、カスタム プロパティを定義できます。 これらは、特定のビルドのフレーバーに対してプロパティをグループ化するための便利な方法です。

ビルド構成について理解を深めるには、**プロパティ マネージャー**を開きます。 これは、お使いの設定に応じて、 **[ビュー] > [プロパティ マネージャー]** または **[ビュー] > [その他のウィンドウ] > [プロパティ マネージャー]** を選択して開くことができます。 **プロパティ マネージャー**には、プロジェクトの構成とプラットフォームのペアごとにノードがあります。 これらの各ノードの下には、その構成に固有のプロパティを設定するプロパティ シート ( *`.props`* ファイル) のノードがあります。

![プロパティ マネージャー](media/property-manager.png "プロパティ マネージャー")

たとえば、[プロパティ ページ] の [General]\(全般\) ペインに進むことができます。 [文字セット] プロパティを "Unicode を使用する" ではなく "未設定" に変更し、 **[OK]** をクリックします。 プロパティ マネージャーには **[Unicode のサポート]** プロパティ シートが表示されなくなります。 現在の構成では削除されていますが、他の構成ではまだ存在しています。

プロパティ マネージャーおよびプロパティ シートの詳細については、[Visual Studio C++ プロジェクト設定の共有または再利用](create-reusable-property-configurations.md)に関するページを参照してください。

> [!TIP]
> *`.user`* ファイルは古い機能です。 構成およびプラットフォームに従ってプロパティが正しくグループ化されるように、これを削除することをお勧めします。
