---
title: Visual Studio プロジェクトでのプロパティの継承 - C++
description: ネイティブ (MSBuild) Visual Studio C++ プロジェクトでのプロパティ継承のしくみ。
ms.date: 02/21/2020
helpviewer_keywords:
- C++ projects, property inheritance
ms.openlocfilehash: 4740c479c6cc7c877fd72b7828a8e4811826de6c
ms.sourcegitcommit: c123cc76bb2b6c5cde6f4c425ece420ac733bf70
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/14/2020
ms.locfileid: "81328476"
---
# <a name="property-inheritance-in-visual-studio-projects"></a>Visual Studio プロジェクトでのプロパティの継承

Visual Studio ネイティブ プロジェクト システムは MSBuild に基づいています。 MSBuild では、あらゆる種類のプロジェクトをビルドするためのファイル形式とルールを定義します。 複数の構成とプラットフォームの構築の複雑さの大部分を管理します。 その仕組みを理解しておくと便利です。 カスタム構成を定義する場合は、特に重要です。 または、複数のプロジェクトに共有およびインポートできるプロパティの再利用可能なセットを作成します。

## <a name="the-vcxproj-file-props-files-and-targets-files"></a>.vcxproj ファイル、.props ファイル、および .targets ファイル

プロジェクトプロパティは、プロジェクト ファイル ( )*`.vcxproj`* に直接格納*`.targets`* されるか*`.props`*、プロジェクト ファイルがインポートされ、デフォルト値を提供する他のファイルに格納されます。 Visual Studio 2015 の場合、これらの*`\Program Files (x86)\MSBuild\Microsoft.Cpp\v4.0\V140`* ファイルは に配置されます。 Visual Studio 2017 では、これらのファイル*`\Program Files (x86)\Microsoft Visual Studio\2017\<edition>\Common7\IDE\VC\VCTargets`* は*`<edition>`* に配置されている、Visual Studio エディションがインストールされます。 Visual Studio 2019 では、これらのファイル*`\Program Files (x86)\Microsoft Visual Studio\2019\<edition>\MSBuild\Microsoft\VC\v160`* は に配置されています。 プロパティは、独自のプロジェクトに*`.props`* 追加できるカスタム ファイルにも格納されます。 これらのファイルを手動で編集しないことを強くお勧めします。 MSBuild について深く理解していない限り、IDE のプロパティ ページを使用して、すべてのプロパティ(特に継承に関与するプロパティ)を変更します。

前に示したように、同じ構成の同じプロパティに対し、これらの異なるファイルで異なる値を割り当てることができます。 プロジェクトをビルドするとき、MSBuild エンジンは、プロジェクト ファイルとすべてのインポートされたファイルを、適切に定義された順序 (後述) で評価します。 各ファイルが評価されると、そのファイルで定義されているすべてのプロパティ値が、既存の値をオーバーライドします。 指定されていない値は、以前に評価されたファイルから継承されます。 プロパティ ページでプロパティを設定する場合は、プロパティの設定場所に注意することも重要です。 *`.props`* ファイル内でプロパティを "X" に設定し、プロジェクト ファイルでプロパティが "Y" に設定されている場合、プロジェクトはプロパティを "Y" に設定してビルドします。 *`.cpp`* ファイルなどのプロジェクト項目で同じプロパティが "Z" に設定されている場合、MSBuild エンジンは "Z" 値を使用します。

基本的な継承ツリーを次に示します。

1. MSBuild CPP ツールセット (..\プログラム ファイル\MSBuild\マイクロソフト.Cpp\v4.0\Microsoft.Cpp.Default.props ファイルによって*`.vcxproj`* インポートされます。

1. プロパティ シート

1. *`.vcxproj`* ファイル。 (既定値とプロパティ シートの設定をオーバーライド可能)。

1. 項目メタデータ

> [!TIP]
> プロパティ ページでは、現在のコンテキストで**太字**のプロパティが定義されます。 通常フォントのプロパティが継承されます。

## <a name="view-an-expanded-project-file-with-all-imported-values"></a>インポートされたすべての値を含む展開されたプロジェクト ファイルを表示する

指定したプロパティ値がどのように継承されているかを特定するために、拡張されたファイルを表示すると便利な場合があります。 拡張されたバージョンを表示するには、Visual Studio コマンド プロンプトで次のコマンドを入力します (プレースホルダー ファイル名を適宜変更してください)。

> **msbuild /pp:**_temp_**.txt** _myapp_**.vcxproj**

拡張されたプロジェクト ファイルは、MSBuild に精通していない限り、大きくて理解しにくい場合があります。 プロジェクト ファイルの基本的な構造を次に示します。

1. IDE で公開されていない基本的なプロジェクトプロパティ。

1. *`Microsoft.cpp.default.props`* のインポート : ツールセットに依存しない基本的なプロパティを定義します。

1. グローバル構成プロパティ **([構成全般**] ページの **[プラットフォームツールセット]** および **[プロジェクト**] の既定のプロパティとして公開されます)。 これらのプロパティは、次の手順で*`Microsoft.cpp.props`* インポートされるツールセットと組み込みプロパティ シートを決定します。

1. *`Microsoft.cpp.props`* のインポート : プロジェクトの既定の大部分を設定します。

1. ファイルを含むすべての*`.user`* プロパティ シートのインポート。 これらのプロパティ シートは、**プラットフォームツールセット**と**プロジェクト**の既定のプロパティを除くすべてのプロパティをオーバーライドできます。

1. プロジェクト構成の残りのプロパティ。 これらの値は、プロパティ シートの設定をオーバーライドできます。

1. 項目 (ファイル) とそのメタデータ。 これらの項目は、他のプロパティやインポートの前に出現する場合でも、常に MSBuild 評価規則の最後の単語です。

詳細については、「 [MSBuild のプロパティ](/visualstudio/msbuild/msbuild-properties)」を参照してください。

## <a name="build-configurations"></a>ビルドの構成

構成は、名前が与えられたプロパティの任意のグループでしかありません。 Visual Studio には、デバッグ構成とリリース構成が用意されています。 デバッグ ビルドまたはリリース ビルドに適したさまざまなプロパティを設定します。 **構成マネージャー**を使用して、カスタム構成を定義できます。 これらは、ビルドの特定のフレーバーのプロパティをグループ化する便利な方法です。

ビルド構成の概念を把握するには、**プロパティ マネージャー**を開きます。 設定に応じて、[プロパティ**マネージャ>表示**] または **[その他> Windows > プロパティ マネージャを表示**] を選択して開くことができます。 **プロパティ マネージャ**には、プロジェクトの各構成とプラットフォーム ペアのノードがあります。 これらの各ノードの下には、その構成に固有の*`.props`* プロパティを設定するプロパティ シート (ファイル) のノードがあります。

![プロパティ マネージャー](media/property-manager.png "プロパティ マネージャー")

たとえば、プロパティ ページの [全般] ウィンドウに移動できます。 文字セットプロパティを "Unicode を使用する" ではなく "設定されていません" に変更し **、[OK]** をクリックします。 プロパティ マネージャに**Unicode サポート**プロパティ シートが表示されなくなりました。 現在の構成では削除されますが、他の構成では引き続き存在します。

プロパティ マネージャーおよびプロパティ シートの詳細については、[Visual Studio C++ プロジェクト設定の共有または再利用](create-reusable-property-configurations.md)に関するページを参照してください。

> [!TIP]
> ファイル*`.user`* はレガシ機能です。 構成とプラットフォームに従ってプロパティを正しくグループ化して保持するために、削除することをお勧めします。
