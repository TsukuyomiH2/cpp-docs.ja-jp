---
title: 'チュートリアル: スタティック ライブラリを作成して使用する (C++)'
description: Visual Studio で C++ を使用してスタティック ライブラリ (.lib) を作成します。
ms.custom: get-started-article
ms.date: 04/13/2020
helpviewer_keywords:
- libraries [C++], static
- static libraries [C++]
ms.assetid: 3cc36411-7d66-4240-851e-dacb9a8fd6ac
ms.openlocfilehash: 6cb379baafc506570b1bdc1b286b35c40f8cd0d8
ms.sourcegitcommit: 9c2b3df9b837879cd17932ae9f61cdd142078260
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 10/29/2020
ms.locfileid: "92924374"
---
# <a name="walkthrough-create-and-use-a-static-library"></a>チュートリアル: スタティック ライブラリを作成して使用する

このチュートリアルでは、C++ アプリケーションに使用するスタティック ライブラリ (.lib ファイル) を作成する方法について説明します。 スタティック ライブラリを使用すると、コードを有効に再利用できます。 機能を必要とするアプリケーションごとに同じルーチンを再実装するのではなく、ルーチンを 1 度スタティック ライブラリに記述しておき、アプリからそれを参照します。 スタティック ライブラリからリンクされるコードはアプリの一部となります。そのコードを使用するために別のファイルをインストールする必要はありません。

このチュートリアルでは、次の作業について説明します。

- [スタティック ライブラリ プロジェクトを作成する](#CreateLibProject)

- [スタティック ライブラリにクラスを追加する](#AddClassToLib)

- [スタティック ライブラリを参照する C++ コンソール アプリを作成する](#CreateAppToRefTheLib)

- [アプリ内でスタティック ライブラリの機能を使用する](#UseLibInApp)

- [アプリを実行する](#RunApp)

## <a name="prerequisites"></a>必須コンポーネント

C++ 言語の基本の理解。

## <a name="create-a-static-library-project"></a><a name="CreateLibProject"></a> スタティック ライブラリ プロジェクトを作成する

プロジェクトを作成する手順は、お使いの Visual Studio のバージョンによって異なります。 優先するバージョンの Visual Studio のドキュメントを表示するには、 **[バージョン]** セレクター コントロールを使用します。 このページの目次の一番上にあります。

::: moniker range="msvc-160"

### <a name="to-create-a-static-library-project-in-visual-studio-2019"></a>Visual Studio 2019 でスタティック ライブラリ プロジェクトを作成するには

1. メニュー バーで、 **[ファイル]** > **[新規作成]** > **[プロジェクト]** の順に選択して、 **[新しいプロジェクトの作成]** ダイアログ ボックスを開きます。

1. ダイアログの上部で、 **[言語]** を **[C++]** に、 **[プラットフォーム]** を **[Windows]** に、 **[プロジェクト タイプ]** を **[ライブラリ]** に設定します。

1. フィルター処理されたプロジェクト タイプの一覧から、 **[Windows デスクトップ ウィザード]** を選択して、 **[次へ]** を選択します。

1. **[新しいプロジェクトの構成]** ページで、 **[プロジェクト名]** ボックスに「*MathLibrary*」と入力して、プロジェクトの名前を指定します。 **[ソリューション名]** ボックスに「*StaticMath*」と入力します。 **[作成]** ボタンを選択して、 **[Windows デスクトップ プロジェクト]** ダイアログを開きます。

1. **[Windows デスクトップ プロジェクト]** ダイアログの **[アプリケーションの種類]** の下で、 **[スタティック ライブラリ (.lib)]** を選択します。

1. **[追加オプション]** で、 **[プリコンパイル済みヘッダー]** チェック ボックスがオンになっている場合は、オフにします。 **[空のプロジェクト]** ボックスをオンにします。

1. **[OK]** を選択して、プロジェクトを作成します。

::: moniker-end

::: moniker range="msvc-150"

### <a name="to-create-a-static-library-project-in-visual-studio-2017"></a>Visual Studio 2017 でスタティック ライブラリ プロジェクトを作成するには

1. メニュー バーで、 **[ファイル]** > **[新規作成]** > **[プロジェクト]** を選択します。

1. **[新しいプロジェクト]** ダイアログ ボックスで、 **[インストール済み]**  >  **[Visual C++]**  >  **[Windows デスクトップ]** の順に選択します。 中央のウィンドウで、 **[Windows デスクトップ ウィザード]** を選択します。

1. **[名前]** ボックスに、プロジェクトの名前 (たとえば「*MathLibrary*」) を入力します。 **[ソリューション名]** ボックスに、ソリューションの名前 (たとえば「*StaticMath*」) を入力します。 **[OK]** を選択します。

1. **[Windows デスクトップ プロジェクト]** ダイアログの **[アプリケーションの種類]** の下で、 **[スタティック ライブラリ (.lib)]** を選択します。

1. **[追加オプション]** で、 **[プリコンパイル済みヘッダー]** チェック ボックスがオンになっている場合は、オフにします。 **[空のプロジェクト]** ボックスをオンにします。

1. **[OK]** を選択して、プロジェクトを作成します。

::: moniker-end

::: moniker range="msvc-140"

### <a name="to-create-a-static-library-project-in-visual-studio-2015"></a>Visual Studio 2015 でスタティック ライブラリ プロジェクトを作成するには

1. メニュー バーで、 **[ファイル]** > **[新規作成]** > **[プロジェクト]** を選択します。

1. **[新しいプロジェクト]** ダイアログ ボックスで、 **[インストール済み]**  >  **[テンプレート]**  >  **[Visual C++]**  >  **[Win32]** の順に選択します。 中央のウィンドウで **[Win32 コンソール アプリケーション]** をクリックします。

1. **[名前]** ボックスに、プロジェクトの名前 (たとえば「*MathLibrary*」) を入力します。 **[ソリューション名]** ボックスに、ソリューションの名前 (たとえば「*StaticMath*」) を入力します。 **[OK]** を選択します。

1. **[Win32 アプリケーション ウィザード]** で、 **[次へ]** を選択します。

1. **[アプリケーションの設定]** ページの **[アプリケーションの種類]** で、 **[スタティック ライブラリ]** を選択します。 **[追加オプション]** で、 **[プリコンパイル済みヘッダー]** チェック ボックスをオフにします。 **[完了]** を選択して、プロジェクトを作成します。

::: moniker-end

## <a name="add-a-class-to-the-static-library"></a><a name="AddClassToLib"></a> スタティック ライブラリにクラスを追加する

### <a name="to-add-a-class-to-the-static-library"></a>スタティック ライブラリにクラスを追加するには

1. 新しいクラスのヘッダー ファイルを作成するには、**ソリューション エクスプローラー** で **MathLibrary** プロジェクトを右クリックしてショートカット メニューを開き、 **[追加]**  >  **[新しい項目]** の順に選択します。

1. **[新しい項目の追加]** ダイアログ ボックスで、 **[Visual C++]**  >  **[コード]** の順に選択します。 中央のウィンドウで、 **[ヘッダー ファイル (.h)]** をクリックします。 このヘッダー ファイルの名前 (たとえば「*MathLibrary.h*」) を指定して、 **[追加]** ボタンを選択します。 ほとんど空白のヘッダー ファイルが表示されます。

1. 加算、減算、乗算、除算などの一般的な数値演算を行うための、`Arithmetic` という名前のクラスの宣言を追加します。 コードは次のようになります。

    ```cpp
    // MathLibrary.h
    #pragma once

    namespace MathLibrary
    {
        class Arithmetic
        {
        public:
            // Returns a + b
            static double Add(double a, double b);

            // Returns a - b
            static double Subtract(double a, double b);

            // Returns a * b
            static double Multiply(double a, double b);

            // Returns a / b
            static double Divide(double a, double b);
        };
    }
    ```

1. 新しいクラスのソース ファイルを作成するには、**ソリューション エクスプローラー** で **MathLibrary** プロジェクトのショートカット メニューを開き、 **[追加]**  >  **[新しい項目]** の順に選択します。

1. **[新しい項目の追加]** ダイアログ ボックスの中央のペインで、 **[C++ ファイル (.cpp)]** を選択します。 このソース ファイルの名前 (たとえば「*MathLibrary.cpp*」) を指定して、 **[追加]** ボタンを選択します。 空白のソース ファイルが表示されます。

1. このソース ファイルを使って、`Arithmetic` クラスの機能を実装します。 コードは次のようになります。

    ```cpp
    // MathLibrary.cpp
    // compile with: cl /c /EHsc MathLibrary.cpp
    // post-build command: lib MathLibrary.obj

    #include "MathLibrary.h"

    namespace MathLibrary
    {
        double Arithmetic::Add(double a, double b)
        {
            return a + b;
        }

        double Arithmetic::Subtract(double a, double b)
        {
            return a - b;
        }

        double Arithmetic::Multiply(double a, double b)
        {
            return a * b;
        }

        double Arithmetic::Divide(double a, double b)
        {
            return a / b;
        }
    }
    ```

1. スタティック ライブラリをビルドするには、メニュー バーで **[ビルド]**  >  **[ソリューションのビルド]** の順に選択します。 ビルドを行うと、他のプログラムで使用できるスタティック ライブラリ *MathLibrary.lib* が作成されます。

   > [!NOTE]
   > プログラムを Visual Studio のコマンド ラインからビルドする場合、2 つの処理によってビルドする必要があります。 最初に、`cl /c /EHsc MathLibrary.cpp` を実行してコードをコンパイルし、*MathLibrary.obj* という名前のオブジェクト ファイルを作成します。(`cl` コマンドは、Cl.exe コンパイラを起動し、`/c` オプションはリンクを行わずにコンパイルすることを指定します。 詳しくは、「[/c (リンクを行わないコンパイル)](../build/reference/c-compile-without-linking.md)」をご覧ください。)次に、`lib MathLibrary.obj` を実行してコードをリンクし、スタティック ライブラリ *MathLibrary.lib* を作成します。 (`lib` コマンドは、Lib.exe ライブラリ マネージャーを起動します。 詳細については、「 [LIB Reference](../build/reference/lib-reference.md)」を参照してください)。

## <a name="create-a-c-console-app-that-references-the-static-library"></a><a name="CreateAppToRefTheLib"></a> スタティック ライブラリを参照する C++ コンソール アプリを作成する

::: moniker range="msvc-160"

### <a name="to-create-a-c-console-app-that-references-the-static-library-in-visual-studio-2019"></a>Visual Studio 2019 でスタティック ライブラリを参照する C++ コンソール アプリを作成するには

1. **ソリューション エクスプローラー** で、最上位ノードである **ソリューション 'StaticMath'** を右クリックし、ショートカット メニューを開きます。 **[追加]**  >  **[新しいプロジェクト]** を選択して、 **[新しいプロジェクトの追加]** ダイアログ ボックスを開きます。

1. ダイアログの上部で、 **[プロジェクト タイプ]** フィルターを **[コンソール]** に設定します。

1. フィルター処理されたプロジェクト タイプの一覧から、 **[コンソール アプリ]** を選択して、 **[次へ]** を選択します。 次のページで、 **[名前]** ボックスに「*MathClient*」と入力してプロジェクトの名前を指定します。

1. **[作成]** ボタンを選択してクライアント プロジェクトを作成します。

1. コンソール アプリケーションを作成すると、空のプログラムが作成されます。 ソース ファイルの名前は、前の処理で付けた名前と同じになります。 この例では、それには `MathClient.cpp` という名前が付いています。

::: moniker-end

::: moniker range="msvc-150"

### <a name="to-create-a-c-console-app-that-references-the-static-library-in-visual-studio-2017"></a>Visual Studio 2017 でスタティック ライブラリを参照する C++ コンソール アプリを作成するには

1. **ソリューション エクスプローラー** で、最上位ノードである **ソリューション 'StaticMath'** を右クリックし、ショートカット メニューを開きます。 **[追加]**  >  **[新しいプロジェクト]** を選択して、 **[新しいプロジェクトの追加]** ダイアログ ボックスを開きます。

1. **[新しいプロジェクトの追加]** ダイアログ ボックスで、 **[インストール済み]**  >  **[Visual C++]**  >  **[Windows デスクトップ]** の順に選択します。 中央のウィンドウで、 **[Windows デスクトップ ウィザード]** を選択します。

1. **[名前]** ボックスに、プロジェクトの名前 (たとえば「*MathClient*」) を入力します。 **[OK]** を選択します。

1. **[Windows デスクトップ プロジェクト]** ダイアログの **[アプリケーションの種類]** の下で、 **[コンソール アプリケーション (.exe)]** を選択します。

1. **[追加オプション]** で、 **[プリコンパイル済みヘッダー]** チェック ボックスがオンになっている場合は、オフにします。

1. **[OK]** を選択して、プロジェクトを作成します。

1. コンソール アプリケーションを作成すると、空のプログラムが作成されます。 ソース ファイルの名前は、前の処理で付けた名前と同じになります。 この例では、それには `MathClient.cpp` という名前が付いています。

::: moniker-end

::: moniker range="msvc-140"

### <a name="to-create-a-c-console-app-that-references-the-static-library-in-visual-studio-2015"></a>Visual Studio 2015 でスタティック ライブラリを参照する C++ コンソール アプリを作成するには

1. **ソリューション エクスプローラー** で、最上位ノードである **ソリューション 'StaticMath'** を右クリックし、ショートカット メニューを開きます。 **[追加]**  >  **[新しいプロジェクト]** を選択して、 **[新しいプロジェクトの追加]** ダイアログ ボックスを開きます。

1. **[新しいプロジェクトの追加]** ダイアログ ボックスで、 **[インストール済み]**  >  **[Visual C++]**  >  **[Win32]** の順に選択します。 中央のウィンドウで **[Win32 コンソール アプリケーション]** をクリックします。

1. **[名前]** ボックスに、プロジェクトの名前 (たとえば「*MathClient*」) を入力します。 **[OK]** を選択します。

1. **[Win32 アプリケーション ウィザード]** ダイアログで、 **[次へ]** を選択します。

1. **[アプリケーションの設定]** ページの **[アプリケーションの種類]** で、 **[コンソール アプリケーション]** が選択されていることを確認します。 **[追加オプション]** で、 **[プリコンパイル済みヘッダー]** をオフにしてから、 **[空のプロジェクト]** チェック ボックスをオンにします。 **[完了]** を選択して、プロジェクトを作成します。

1. 空のプロジェクトにソース ファイルを追加するには、**ソリューション エクスプローラー** で **MathClient** プロジェクトを右クリックしてショートカット メニューを開き、 **[追加]** > **[新しい項目]** の順に選択します。

1. **[新しい項目の追加]** ダイアログ ボックスで、 **[Visual C++]**  >  **[コード]** の順に選択します。 中央のウィンドウで、 **[C++ ファイル (.cpp)]** をクリックします。 このソース ファイルの名前 (たとえば「*MathClient.cpp*」) を指定して、 **[追加]** ボタンを選択します。 空白のソース ファイルが表示されます。

::: moniker-end

## <a name="use-the-functionality-from-the-static-library-in-the-app"></a><a name="UseLibInApp"></a> アプリ内でスタティック ライブラリの機能を使用する

### <a name="to-use-the-functionality-from-the-static-library-in-the-app"></a>アプリケーションでのスタティック ライブラリの機能を使用するには

1. スタティック ライブラリの数値演算ルーチンを使用するには、それを参照する必要があります。 **ソリューション エクスプローラー** で **MathClient** プロジェクトのショートカット メニューを開いてから、 **[追加]**  >  **[参照]** の順に選択します。

1. **[参照の追加]** ダイアログ ボックスには、参照できるライブラリが表示されます。 **[プロジェクト]** タブでは、現在のソリューション内のプロジェクトと、それらによって参照されるすべてのライブラリが一覧表示されます。 **[プロジェクト]** タブを開き、**MathLibrary** のチェック ボックスをオンにし、 **[OK]** ボタンを選択します。

1. `MathLibrary.h` ヘッダー ファイルを参照するには、含まれるディレクトリ パスを変更する必要があります。 **ソリューション エクスプローラー** で **MathClient** を右クリックし、ショートカット メニューを開きます。 **[プロパティ]** を選択して、 **[MathClient プロパティ ページ]** ダイアログ ボックスを開きます。

1. **[MathClient プロパティ ページ]** ダイアログ ボックスで、 **[構成]** ドロップダウンを **[すべての構成]** に設定します。 **[プラットフォーム]** ドロップダウンを **[すべてのプラットフォーム]** に設定します。

1. **[構成プロパティ]**  >  **[C/C++]**  >  **[全般]** プロパティ ページを選択します。 **[追加のインクルード ディレクトリ]** プロパティで、**MathLibrary** ディレクトリへのパスを指定するか、参照します。

   ディレクトリ パスを参照するには、次のようにします。

   1. **[追加のインクルード ディレクトリ]** プロパティ値のドロップダウン リストを開き、 **[編集]** を選択します。

   1. **[追加のインクルード ディレクトリ]** ダイアログ ボックスで、テキスト ボックスの上部をダブルクリックします。 次に、行の末尾にある省略記号ボタン ( **[...]** ) を選択します。

   1. **[ディレクトリの選択]** ダイアログ ボックスで、1 レベル上に移動し、**MathLibrary** ディレクトリを選択します。 次に、 **[フォルダーの選択]** ボタンを選択して、選択内容を保存します。

   1. **[追加のインクルード ディレクトリ]** ダイアログ ボックスで、 **[OK]** ボタンを選択します。

   1. **[プロパティ ページ]** ダイアログ ボックスで、 **[OK]** ボタンを選択してプロジェクトへの変更を保存します。

1. これで、コードに `#include "MathLibrary.h"` ヘッダーを含めることによって、このアプリで `Arithmetic` クラスを使用できるようになりました。 `MathClient.cpp` の内容を次のコードに置き換えます。

    ```cpp
    // MathClient.cpp
    // compile with: cl /EHsc MathClient.cpp /link MathLibrary.lib

    #include <iostream>
    #include "MathLibrary.h"

    int main()
    {
        double a = 7.4;
        int b = 99;

        std::cout << "a + b = " <<
            MathLibrary::Arithmetic::Add(a, b) << std::endl;
        std::cout << "a - b = " <<
            MathLibrary::Arithmetic::Subtract(a, b) << std::endl;
        std::cout << "a * b = " <<
            MathLibrary::Arithmetic::Multiply(a, b) << std::endl;
        std::cout << "a / b = " <<
            MathLibrary::Arithmetic::Divide(a, b) << std::endl;

        return 0;
    }
    ```

1. 実行可能ファイルをビルドするには、メニュー バーで **[ビルド]**  >  **[ソリューションのビルド]** の順に選択します。

## <a name="run-the-app"></a><a name="RunApp"></a> アプリを実行する

### <a name="to-run-the-app"></a>アプリケーションを実行するには

1. **MathClient** が既定のプロジェクトとして選択されていることを確認します。 これを選択するには、**ソリューション エクスプローラー** で **MathClient** を右クリックしてショートカット メニューを開き、 **[スタートアップ プロジェクトに設定]** を選択します。

1. プロジェクトを実行するには、メニュー バーで **[デバッグ]**  >  **[デバッグなしで開始]** の順にクリックします。 出力は次のようになります。

    ```Output
    a + b = 106.4
    a - b = -91.6
    a * b = 732.6
    a / b = 0.0747475
    ```

## <a name="see-also"></a>関連項目

[チュートリアル: ダイナミック リンク ライブラリの作成と使用 (C++)](../build/walkthrough-creating-and-using-a-dynamic-link-library-cpp.md)<br/>
[デスクトップ アプリケーション (Visual C++)](../windows/desktop-applications-visual-cpp.md)<br/>
