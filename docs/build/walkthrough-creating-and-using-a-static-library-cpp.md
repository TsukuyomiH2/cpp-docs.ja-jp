---
title: 'チュートリアル: 静的ライブラリを作成して使用する (C++)'
description: C++ を使用して、Visual Studio で静的ライブラリ (.lib) を作成します。
ms.custom: get-started-article
ms.date: 04/13/2020
helpviewer_keywords:
- libraries [C++], static
- static libraries [C++]
ms.assetid: 3cc36411-7d66-4240-851e-dacb9a8fd6ac
ms.openlocfilehash: 7148cc1de7c06ae57d61560311b342a1fc9dda1f
ms.sourcegitcommit: c123cc76bb2b6c5cde6f4c425ece420ac733bf70
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/14/2020
ms.locfileid: "81335148"
---
# <a name="walkthrough-create-and-use-a-static-library"></a>チュートリアル: 静的ライブラリを作成して使用する

このチュートリアルでは、C++ アプリケーションに使用するスタティック ライブラリ (.lib ファイル) を作成する方法について説明します。 スタティック ライブラリを使用すると、コードを有効に再利用できます。 機能を必要とするすべてのアプリで同じルーチンを再実装するのではなく、静的ライブラリに 1 回記述してから、アプリから参照します。 静的ライブラリからリンクされたコードはアプリの一部となり、コードを使用するために別のファイルをインストールする必要はありません。

このチュートリアルでは、次の作業について説明します。

- [スタティック ライブラリ プロジェクトを作成する](#CreateLibProject)

- [静的ライブラリにクラスを追加する](#AddClassToLib)

- [静的ライブラリを参照する C++ コンソール アプリを作成する](#CreateAppToRefTheLib)

- [アプリで静的ライブラリの機能を使用する](#UseLibInApp)

- [アプリを実行する](#RunApp)

## <a name="prerequisites"></a>前提条件

C++ 言語の基本の理解。

## <a name="create-a-static-library-project"></a><a name="CreateLibProject"></a>スタティック ライブラリ プロジェクトを作成する

プロジェクトを作成する手順は、使用しているバージョンの Visual Studio によって異なります。 Visual Studio の優先バージョンのドキュメントを表示するには、**バージョン**セレクター コントロールを使用します。 このページの目次の上部に表示されます。

::: moniker range="vs-2019"

### <a name="to-create-a-static-library-project-in-visual-studio-2019"></a>Visual Studio 2019 で静的ライブラリ プロジェクトを作成するには

1. メニューバーで、**[ファイル]** > **[新規作成]** > **[プロジェクト]** の順に選択して、**[新しいプロジェクトの作成]** ダイアログ ボックスを開きます。

1. ダイアログの上部で、**[言語]** を **[C++]** に、**[プラットフォーム]** を **[Windows]** に、**[プロジェクト タイプ]** を **[ライブラリ]** に設定します。

1. フィルタ処理されたプロジェクトの種類の一覧から **[Windows デスクトップ ウィザード**] を選択し、[**次へ**] を選択します。

1. [**新しいプロジェクトの構成]** ページで、[**プロジェクト名**] ボックスに *「MathLibrary」* と入力してプロジェクトの名前を指定します。 **[ソリューション名**] ボックスに *「StaticMath」* と入力します。 [**作成**] をクリックして **[Windows デスクトップ プロジェクト**]ダイアログを開きます。

1. [Windows**デスクトップ プロジェクト**] ダイアログの [**アプリケーションの種類**] で、[**静的ライブラリ (.lib)]** を選択します。

1. [**追加オプション**] で[**プリコンパイル済みヘッダー** ] チェック ボックスがオンになっている場合はオフにします。 [**空のプロジェクト**] ボックスをオンにします。

1. **[OK] を**選択してプロジェクトを作成します。

::: moniker-end

::: moniker range="vs-2017"

### <a name="to-create-a-static-library-project-in-visual-studio-2017"></a>Visual Studio 2017 で静的ライブラリ プロジェクトを作成するには

1. メニュー バーで、**[ファイル]** > **[新規作成]** > **[プロジェクト]** を選択します。

1. [**新しいプロジェクト**] ダイアログ ボックスで、[**インストールされている** > **Visual C++** > **Windows デスクトップ**] を選択します。 中央のウィンドウで、**[Windows デスクトップ ウィザード]** を選択します。

1. プロジェクトの名前 *(MathLibrary*など) を **[名前**] ボックスに指定します。 [ソリューション名] ボックスに、ソリューションの**名前** *(StaticMath*など) を指定します。 **[OK]** をクリックします。

1. [Windows**デスクトップ プロジェクト**] ダイアログの [**アプリケーションの種類**] で、[**静的ライブラリ (.lib)]** を選択します。

1. [**追加オプション]** で[**プリコンパイル済みヘッダー** ] チェック ボックスがオンになっている場合はオフにします。 [**空のプロジェクト**] ボックスをオンにします。

1. **[OK] を**選択してプロジェクトを作成します。

::: moniker-end

::: moniker range="vs-2015"

### <a name="to-create-a-static-library-project-in-visual-studio-2015"></a>Visual Studio 2015 で静的ライブラリ プロジェクトを作成するには

1. メニュー バーで、**[ファイル]** > **[新規作成]** > **[プロジェクト]** を選択します。

1. [**新しいプロジェクト**] ダイアログ ボックスで、[**インストールされている** > **テンプレート** > **Visual C++** > **Win32]** を選択します。 中央のウィンドウで **[Win32 コンソール アプリケーション]** をクリックします。

1. プロジェクトの名前 *(MathLibrary*など) を **[名前**] ボックスに指定します。 [ソリューション名] ボックスに、ソリューションの**名前** *(StaticMath*など) を指定します。 **[OK]** をクリックします。

1. **Win32 アプリケーション ウィザード**で 、[**次へ**] をクリックします。

1. [**アプリケーションの設定] ページ**の [**アプリケーションの種類**] で、[**静的ライブラリ**] を選択します。 [**追加オプション**] で、[**プリコンパイル済みヘッダー** ] チェック ボックスをオフにします。 [**完了] を**選択してプロジェクトを作成します。

::: moniker-end

## <a name="add-a-class-to-the-static-library"></a><a name="AddClassToLib"></a>静的ライブラリにクラスを追加する

### <a name="to-add-a-class-to-the-static-library"></a>スタティック ライブラリにクラスを追加するには

1. 新しいクラスのヘッダー ファイルを作成するには、右クリックして**MathLibrary**プロジェクトのショートカット メニューを**開**き、ソリューション エクスプローラで [**新しい項目**の**追加** > ] をクリックします。

1. [**新しい項目の追加**] ダイアログ ボックスで **、[Visual C++** > **コード**] をクリックします。 中央のウィンドウで、 **[ヘッダー ファイル (.h)]** をクリックします。 ヘッダー ファイルの名前 *(MathLibrary.h*など) を指定し、[**追加**] ボタンをクリックします。 ほぼ空白のヘッダー ファイルが表示されます。

1. 加算、減算、乗算、`Arithmetic`除算などの一般的な数学的演算を行うクラスの宣言を追加します。 コードは次のようになります。

    ```cpp
    // MathLibrary.h
    #pragma once

    namespace MathLibrary
    {
        class Arithmetic
        {
        public:
            // Returns a + b
            static double Add(double a, double b);

            // Returns a - b
            static double Subtract(double a, double b);

            // Returns a * b
            static double Multiply(double a, double b);

            // Returns a / b
            static double Divide(double a, double b);
        };
    }
    ```

1. 新しいクラスのソース ファイルを作成するには、**ソリューション エクスプローラ**で**MathLibrary**プロジェクトのショートカット メニューを開き、[**新しい項目**の**追加** > ] をクリックします。

1. [**新しい項目の追加**] ダイアログ ボックスの中央のウィンドウで **、[C++ ファイル (.cpp)]** を選択します。 ソース ファイルの名前 *(MathLibrary.cpp*など) を指定し、[**追加**] ボタンをクリックします。 空白のソース ファイルが表示されます。

1. このソース ファイルを使用して、 クラス`Arithmetic`の機能を実装します。 コードは次のようになります。

    ```cpp
    // MathLibrary.cpp
    // compile with: cl /c /EHsc MathLibrary.cpp
    // post-build command: lib MathLibrary.obj

    #include "MathLibrary.h"

    namespace MathLibrary
    {
        double Arithmetic::Add(double a, double b)
        {
            return a + b;
        }

        double Arithmetic::Subtract(double a, double b)
        {
            return a - b;
        }

        double Arithmetic::Multiply(double a, double b)
        {
            return a * b;
        }

        double Arithmetic::Divide(double a, double b)
        {
            return a / b;
        }
    }
    ```

1. 静的ライブラリをビルドするには、メニュー バーの **[ビルド** > **ソリューション**] を選択します。 ビルドは、他のプログラムで使用できる静的ライブラリ*MathLibrary.lib*を作成します。

   > [!NOTE]
   > プログラムを Visual Studio のコマンド ラインからビルドする場合、2 つの処理によってビルドする必要があります。 まず、コード`cl /c /EHsc MathLibrary.cpp`をコンパイルし *、MathLibrary.obj*という名前のオブジェクト ファイルを作成します。(この`cl`コマンドはコンパイラ Cl.exe を呼び出`/c`し、オプションはリンクせずにコンパイルを指定します。 詳細については[、/c (リンクせずにコンパイルする)](../build/reference/c-compile-without-linking.md)を参照してください。次に、`lib MathLibrary.obj`コードをリンクして静的ライブラリ*MathLibrary.lib*を作成します。 (`lib` コマンドは、Lib.exe ライブラリ マネージャーを起動します。 詳細については、「 [LIB Reference](../build/reference/lib-reference.md)」を参照してください)。

## <a name="create-a-c-console-app-that-references-the-static-library"></a><a name="CreateAppToRefTheLib"></a>静的ライブラリを参照する C++ コンソール アプリを作成する

::: moniker range="vs-2019"

### <a name="to-create-a-c-console-app-that-references-the-static-library-in-visual-studio-2019"></a>Visual Studio 2019 で静的ライブラリを参照する C++ コンソール アプリを作成するには

1. **ソリューション エクスプローラ**で、最上位ノードの **[ソリューション 'StaticMath'** を右クリックし、ショートカット メニューを開きます。 [**新しいプロジェクト**の**追加]** > を選択して、[**新しいプロジェクトの追加]** ダイアログ ボックスを開きます。

1. ダイアログの上部で、[**プロジェクトの種類**] フィルタを **[コンソール]** に設定します。

1. フィルター処理されたプロジェクト タイプの一覧から、**[コンソール アプリ]** を選択して、**[次へ]** を選択します。 次のページで、**名前**ボックスに *「MathClient」* と入力してプロジェクトの名前を指定します。

1. **[作成]** ボタンを選択してクライアント プロジェクトを作成します。

1. コンソール アプリケーションを作成すると、空のプログラムが作成されます。 ソース ファイルの名前は、前の処理で付けた名前と同じになります。 この例では、 という名前`MathClient.cpp`です。

::: moniker-end

::: moniker range="vs-2017"

### <a name="to-create-a-c-console-app-that-references-the-static-library-in-visual-studio-2017"></a>Visual Studio 2017 で静的ライブラリを参照する C++ コンソール アプリを作成するには

1. **ソリューション エクスプローラ**で、最上位ノードの **[ソリューション 'StaticMath'** を右クリックし、ショートカット メニューを開きます。 [**新しいプロジェクト**の**追加]** > を選択して、[**新しいプロジェクトの追加]** ダイアログ ボックスを開きます。

1. [**新しいプロジェクトの追加**] ダイアログ ボックスで、[**インストールされている** > **Visual C++** > **Windows デスクトップ**] を選択します。 中央のウィンドウで、**[Windows デスクトップ ウィザード]** を選択します。

1. プロジェクトの名前 *(MathClient*など) を **[名前**] ボックスに指定します。 **[OK]** をクリックします。

1. [Windows**デスクトップ プロジェクト**] ダイアログの [**アプリケーションの種類**] で、[**コンソール アプリケーション (.exe)]** を選択します。

1. [**追加オプション]** で[**プリコンパイル済みヘッダー** ] チェック ボックスがオンになっている場合はオフにします。

1. **[OK] を**選択してプロジェクトを作成します。

1. コンソール アプリケーションを作成すると、空のプログラムが作成されます。 ソース ファイルの名前は、前の処理で付けた名前と同じになります。 この例では、 という名前`MathClient.cpp`です。

::: moniker-end

::: moniker range="vs-2015"

### <a name="to-create-a-c-console-app-that-references-the-static-library-in-visual-studio-2015"></a>Visual Studio 2015 で静的ライブラリを参照する C++ コンソール アプリを作成するには

1. **ソリューション エクスプローラ**で、最上位ノードの **[ソリューション 'StaticMath'** を右クリックし、ショートカット メニューを開きます。 [**新しいプロジェクト**の**追加]** > を選択して、[**新しいプロジェクトの追加]** ダイアログ ボックスを開きます。

1. [**新しいプロジェクトの追加**] ダイアログ ボックスで、[**インストールされている** > **Visual C++** > **Win32]** を選択します。 中央のウィンドウで **[Win32 コンソール アプリケーション]** をクリックします。

1. プロジェクトの名前 *(MathClient*など) を **[名前**] ボックスに指定します。 **[OK]** をクリックします。

1. **[Win32 アプリケーション ウィザード]** ダイアログで、[**次へ**] をクリックします。

1. [**アプリケーションの設定]** ページの [**アプリケーションの種類**] で、[**コンソール アプリケーション**] が選択されていることを確認します。 [**追加オプション**] の [**プリコンパイル済みヘッダー**] チェック ボックスをオフにし、[**空のプロジェクト**] チェック ボックスをオンにします。 [**完了] を**選択してプロジェクトを作成します。

1. ソース ファイルを空のプロジェクトに追加するには、右クリックして**MathClient**プロジェクトのショートカット メニューを**開**き、ソリューション エクスプローラで [**新しい項目**の**追加**>] をクリックします。

1. [**新しい項目の追加**] ダイアログ ボックスで **、[Visual C++** > **コード**] をクリックします。 中央のウィンドウで、 **[C++ ファイル (.cpp)]** をクリックします。 ソース ファイルの名前 *(MathClient.cpp*など) を指定し、[**追加**] ボタンをクリックします。 空白のソース ファイルが表示されます。

::: moniker-end

## <a name="use-the-functionality-from-the-static-library-in-the-app"></a><a name="UseLibInApp"></a>アプリで静的ライブラリの機能を使用する

### <a name="to-use-the-functionality-from-the-static-library-in-the-app"></a>アプリケーションでのスタティック ライブラリの機能を使用するには

1. スタティック ライブラリの数値演算ルーチンを使用するには、それを参照する必要があります。 **MathClient**プロジェクトのショートカット メニューを**ソリューション エクスプローラ**で開き、[**Add** > **参照**の追加] をクリックします。

1. **[参照の追加]** ダイアログ ボックスには、参照できるライブラリが表示されます。 [**プロジェクト]** タブには、現在のソリューション内のプロジェクトと、そのプロジェクトが参照するライブラリが一覧表示されます。 [**プロジェクト**] タブを開き **、[MathLibrary]** チェック ボックスをオンにして **、[OK] をクリックします**。

1. ヘッダー ファイル`MathLibrary.h`を参照するには、インクルードディレクトリのパスを変更する必要があります。 **ソリューション エクスプローラー**で **、MathClient**を右クリックしてショートカット メニューを開きます。 **[プロパティ] を**選択して **、[MathClient プロパティ ページ]** ダイアログ ボックスを開きます。

1. **[MathClient プロパティ ページ]** ダイアログ ボックスで、[**構成**] ドロップダウンを **[すべての構成]** に設定します。 **[プラットフォーム**] ドロップダウンを **[すべてのプラットフォーム] に**設定します。

1. **[構成プロパティ** > **C/C++** > 全般] プロパティ ページ**を**選択します。 追加インクルード**ディレクトリ**プロパティで **、MathLibrary**ディレクトリのパスを指定するか、参照して参照します。

   ディレクトリ パスを参照するには、次の手順を実行します。

   1. [追加インクルード ディレクトリ] プロパティの値ドロップダウン リスト**を**開き、[**編集**] を選択します。

   1. [**追加のインクルード ディレクトリ]** ダイアログ ボックスで、テキスト ボックスの上部をダブルクリックします。 次に、行の最後にある省略記号ボタン **(..**) を選択します。

   1. [**ディレクトリの選択**] ダイアログ ボックスで、レベルを上に移動し **、MathLibrary**ディレクトリを選択します。 次に、[**フォルダの選択]** ボタンを選択して、選択内容を保存します。

   1. [**追加のインクルード ディレクトリ]** ダイアログ ボックスで **、[OK] を**クリックします。

   1. [**プロパティ ページ**] ダイアログ ボックスで **[OK] ボタン**をクリックして、プロジェクトに対する変更を保存します。

1. コードにヘッダーを`Arithmetic`含めることで、このアプリでクラス`#include "MathLibrary.h"`を使用できるようになりました。 の内容を次`MathClient.cpp`のコードに置き換えます。

    ```cpp
    // MathClient.cpp
    // compile with: cl /EHsc MathClient.cpp /link MathLibrary.lib

    #include <iostream>
    #include "MathLibrary.h"

    int main()
    {
        double a = 7.4;
        int b = 99;

        std::cout << "a + b = " <<
            MathLibrary::Arithmetic::Add(a, b) << std::endl;
        std::cout << "a - b = " <<
            MathLibrary::Arithmetic::Subtract(a, b) << std::endl;
        std::cout << "a * b = " <<
            MathLibrary::Arithmetic::Multiply(a, b) << std::endl;
        std::cout << "a / b = " <<
            MathLibrary::Arithmetic::Divide(a, b) << std::endl;

        return 0;
    }
    ```

1. 実行可能ファイルをビルドするには、メニュー バーの **[ビルド** > **ソリューション**] を選択します。

## <a name="run-the-app"></a><a name="RunApp"></a>アプリを実行する

### <a name="to-run-the-app"></a>アプリケーションを実行するには

1. **[MathClient]** が既定のプロジェクトとして選択されていることを確認します。 これを選択するには、右クリックして**ソリューション エクスプローラ**で**MathClient**のショートカット メニューを開き、[**スタートアップ プロジェクトに設定]** をクリックします。

1. プロジェクトを実行するには、メニュー バーで [**デバッグ** > **なしでデバッグ開始**] を選択します。 出力は次のようになります。

    ```Output
    a + b = 106.4
    a - b = -91.6
    a * b = 732.6
    a / b = 0.0747475
    ```

## <a name="see-also"></a>関連項目

[チュートリアル : ダイナミック リンク ライブラリの作成と使用 (C++)](../build/walkthrough-creating-and-using-a-dynamic-link-library-cpp.md)<br/>
[デスクトップ アプリケーション (Visual C++)](../windows/desktop-applications-visual-cpp.md)<br/>
