---
title: 'チュートリアル: スタティック ライブラリの作成と使用 (C++)'
description: をC++使用して、Visual Studio でスタティックライブラリ (.lib) を作成します。
ms.custom: get-started-article
ms.date: 04/25/2019
helpviewer_keywords:
- libraries [C++], static
- static libraries [C++]
ms.assetid: 3cc36411-7d66-4240-851e-dacb9a8fd6ac
ms.author: corob
ms.openlocfilehash: c81ccd970383c8571a7d0d1e77d4b8fe44900bcf
ms.sourcegitcommit: 8e285a766523e653aeeb34d412dc6f615ef7b17b
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/21/2020
ms.locfileid: "80078188"
---
# <a name="walkthrough-creating-and-using-a-static-library-c"></a>チュートリアル: スタティック ライブラリの作成と使用 (C++)

このチュートリアルでは、C++ アプリケーションに使用するスタティック ライブラリ (.lib ファイル) を作成する方法について説明します。 スタティック ライブラリを使用すると、コードを有効に再利用できます。 機能を必要とするすべてのアプリで同じルーチンを再実装するのではなく、それらを一度に静的ライブラリに書き込んでから、アプリから参照します。 スタティック ライブラリからリンクされたコードはアプリケーションの一部となります。コードを使用する別のファイルをインストールする必要はありません。

このチュートリアルでは、次の作業について説明します。

- [スタティック ライブラリ プロジェクトの作成](#CreateLibProject)

- [スタティック ライブラリへのクラスの追加](#AddClassToLib)

- [スタティック ライブラリを参照する C++ コンソール アプリケーションの作成](#CreateAppToRefTheLib)

- [アプリケーションでのスタティック ライブラリの機能の使用](#UseLibInApp)

- [アプリケーションの実行](#RunApp)

## <a name="prerequisites"></a>前提条件

C++ 言語の基本の理解。

##  <a name="creating-a-static-library-project"></a><a name="CreateLibProject"></a> スタティック ライブラリ プロジェクトの作成

プロジェクトを作成する方法の手順は、Visual Studio 2019 またはそれ以前のバージョンのどちらを使用しているかによって異なります。 このページの左上に正しいバージョンが設定されていることを確認します。

::: moniker range="vs-2019"

### <a name="to-create-a-static-library-project-in-visual-studio-2019"></a>Visual Studio 2019 でスタティックライブラリプロジェクトを作成するには

1. メニューバーで [**ファイル**>**新規**>**プロジェクト**] を選択し、 **[新しいプロジェクトの作成]** ダイアログボックスを開きます。

1. ダイアログの上部で、 **[言語]** を **[C++]** に、 **[プラットフォーム]** を **[Windows]** に、 **[プロジェクト タイプ]** を **[ライブラリ]** に設定します。

1. フィルター処理されたプロジェクトの種類の一覧から **[スタティックライブラリ]** を選択し、 **[次へ]** を選択します。 次のページで、 **[名前]** ボックスに「 *MathFuncsLib* 」と入力し、プロジェクトの名前を指定します。必要に応じて、プロジェクトの場所を指定します。

1. **[作成]** ボタンを選択してクライアント プロジェクトを作成します。

::: moniker-end

::: moniker range="vs-2017"

### <a name="to-create-a-static-library-project-in-visual-studio-2017"></a>Visual Studio 2017 でスタティックライブラリプロジェクトを作成するには

1. メニュー バーで、 **[ファイル]** > **[新規作成]** > **[プロジェクト]** を選択します。

1. **[新しいプロジェクト]** ダイアログボックスの左ペインで、[**インストールされている** > **ビジュアルC++** ] を展開し、 **[Windows デスクトップ]** を選択します。 中央のウィンドウで、 **[Windows デスクトップ ウィザード]** を選択します。

1. *[名前]* ボックスにプロジェクトの名前を入力します。たとえば、「 **MathFuncsLib** 」と入力します。 *[ソリューション名]* ボックスにソリューションの名前を入力します。たとえば、「 **StaticLibrary** 」と入力します。 **[OK]** をクリックします。

1. **[アプリケーションの種類]** で、 **[スタティックライブラリ (.lib)]** を選択します。

1. **[追加オプション]** で、 **[プリコンパイル済みヘッダー]** チェックボックスをオフにします。

1. **[OK]** を選択して、プロジェクトを作成します。

::: moniker-end

::: moniker range="vs-2015"

### <a name="to-create-a-static-library-project-in-visual-studio-2015"></a>Visual Studio 2015 でスタティックライブラリプロジェクトを作成するには

1. メニュー バーで、 **[ファイル]** > **[新規作成]** > **[プロジェクト]** を選択します。

1. **[新しいプロジェクト]** ダイアログボックスで、 **[インストールされている** > **テンプレート** >  **C++ビジュアル**] を展開し、 **[Win32]** を選択します。 中央のウィンドウで **[Win32 コンソール アプリケーション]** をクリックします。

1. *[名前]* ボックスにプロジェクトの名前を入力します。たとえば、「 **MathFuncsLib** 」と入力します。 *[ソリューション名]* ボックスにソリューションの名前を入力します。たとえば、「 **StaticLibrary** 」と入力します。 **[OK]** をクリックします。

1. **[次へ]** をクリックします。

1. **[アプリケーションの種類]** で、 **[スタティックライブラリ]** を選択します。 次に、 **[プリコンパイル済みヘッダー]** ボックスをオフにし、 **[完了]** を選択します。

::: moniker-end

##  <a name="adding-a-class-to-the-static-library"></a><a name="AddClassToLib"></a> スタティック ライブラリへのクラスの追加

### <a name="to-add-a-class-to-the-static-library"></a>スタティック ライブラリにクラスを追加するには

1. 新しいクラスのヘッダーファイルを作成するには、**ソリューションエクスプローラー**で**MathFuncsLib**プロジェクトのショートカットメニューを開き、[ > **新しい項目**の**追加**] を選択します。 **[新しい項目の追加]** ダイアログ ボックスの左ウィンドウで、 **[Visual C++]** の下の **[コード]** を選択します。 中央のウィンドウで、 **[ヘッダー ファイル (.h)]** をクリックします。 このヘッダー ファイルの名前を指定します。たとえば、「 *MathFuncsLib.h*」と入力します。 **[追加]** ボタンをクリックします。 空白のヘッダー ファイルが表示されます。

1. 加算、減算、乗算、除算などの一般的な数値演算を実行するために、`MyMathFuncs` という名前のクラスを追加します。 コードは次のようになります。

   [!code-cpp[NVC_Walkthrough_Create_Static_Lib#100](../windows/codesnippet/CPP/walkthrough-creating-and-using-a-static-library-cpp_1.h)]

1. 新しいクラスのソースファイルを作成するには、**ソリューションエクスプローラー**で**MathFuncsLib**プロジェクトのショートカットメニューを開き、[ > **新しい項目**の**追加**] を選択します。 **[新しい項目の追加]** ダイアログ ボックスの左ウィンドウで、 **[Visual C++]** の下の **[コード]** を選択します。 中央のウィンドウで、 **[C++ ファイル (.cpp)]** をクリックします。 このソース ファイルの名前を指定します。たとえば、「 *MathFuncsLib.cpp*」と入力します。 **[追加]** ボタンをクリックします。 空白のソース ファイルが表示されます。

1. このソース ファイルを使って、 **MyMathFuncs**の機能を実装します。 コードは次のようになります。

   [!code-cpp[NVC_Walkthrough_Create_Static_Lib#110](../windows/codesnippet/CPP/walkthrough-creating-and-using-a-static-library-cpp_2.cpp)]

1. メニューバーの [**ビルド** > **ビルドソリューション**] を選択して、スタティックライブラリをコンパイルします。 コンパイルによって、他のプログラムで使用できるスタティックライブラリが作成されます。

   > [!NOTE]
   > プログラムを Visual Studio のコマンド ラインからビルドする場合、2 つの処理によってビルドする必要があります。 最初に、`cl /c /EHsc MathFuncsLib.cpp` を実行してコードをコンパイルし、`MathFuncsLib.obj`という名前のオブジェクトファイルを作成します。 (`cl` コマンドは、Cl.exe コンパイラを起動し、`/c` オプションはリンクを行わずにコンパイルすることを指定します。 詳細については、「 [/c (リンクなしのコンパイル)](../build/reference/c-compile-without-linking.md)」を参照してください。次に、`lib MathFuncsLib.obj` を実行してコードをリンクし、スタティックライブラリ `MathFuncsLib.lib`を作成します。 (`lib` コマンドは、Lib.exe ライブラリ マネージャーを起動します。 詳細については、「 [LIB Reference](../build/reference/lib-reference.md)」を参照してください)。

##  <a name="creating-a-c-console-app-that-references-the-static-library"></a><a name="CreateAppToRefTheLib"></a> スタティック ライブラリを参照する C++ コンソール アプリケーションの作成

::: moniker range="vs-2019"

### <a name="to-create-a-c-console-app-that-references-the-static-library-in-visual-studio-2019"></a>Visual Studio 2019 C++でスタティックライブラリを参照するコンソールアプリを作成するには

1. **ソリューションエクスプローラー**で、ソリューションの最上位ノードを右クリックし、[>**新しいプロジェクト**の**追加**] をクリックして、 **[新しいプロジェクトの追加]** ダイアログボックスを開きます。

1. ダイアログの上部で、 **[言語]** を **[C++]** に、 **[プラットフォーム]** を **[Windows]** に、 **[プロジェクト タイプ]** を **[コンソール]** に設定します。

1. フィルター処理されたプロジェクト タイプの一覧から、 **[コンソール アプリ]** を選択して、 **[次へ]** を選択します。 次のページで、 **[名前]** ボックスに「 *MyExecRefsLib* 」と入力し、プロジェクトの名前を指定します。必要に応じて、プロジェクトの場所を指定します。

1. **[作成]** ボタンを選択してクライアント プロジェクトを作成します。

::: moniker-end

::: moniker range="vs-2017"

### <a name="to-create-a-c-console-app-that-references-the-static-library-in-visual-studio-2017"></a>Visual Studio 2017 C++でスタティックライブラリを参照するコンソールアプリを作成するには

1. メニュー バーで、 **[ファイル]** > **[新規作成]** > **[プロジェクト]** を選択します。

1. **[新しいプロジェクト]** ダイアログボックスの左ペインで、[**インストールされている** > **ビジュアルC++** ] を展開し、 **[Windows デスクトップ]** を選択します。 中央のウィンドウで、 **[Windows デスクトップ ウィザード]** を選択します。

1. *[名前]* ボックスにプロジェクトの名前を入力します。たとえば、「 **MyExecRefsLib** 」と入力します。 **[ソリューション]** の横のドロップダウン リストで、 **[ソリューションに追加]** をクリックします。 このコマンドは、スタティックライブラリを含むソリューションに新しいプロジェクトを追加します。 **[OK]** をクリックします。

1. **[アプリケーションの種類]** で **[コンソールアプリケーション (.exe)]** を選択します。

1. **[追加オプション]** で、 **[プリコンパイル済みヘッダー]** チェックボックスをオフにします。

1. **[OK]** を選択して、プロジェクトを作成します。

::: moniker-end

::: moniker range="vs-2015"

### <a name="to-create-a-c-console-app-that-references-the-static-library-in-visual-studio-2015"></a>Visual Studio 2015 C++でスタティックライブラリを参照するコンソールアプリを作成するには

1. メニュー バーで、 **[ファイル]** > **[新規作成]** > **[プロジェクト]** を選択します。

1. **[新しいプロジェクト]** ダイアログボックスで、 **[インストールされている** > **テンプレート** >  **C++ビジュアル**] を展開し、 **[Win32]** を選択します。 中央のウィンドウで **[Win32 コンソール アプリケーション]** をクリックします。

1. *[名前]* ボックスにプロジェクトの名前を入力します。たとえば、「 **MyExecRefsLib** 」と入力します。 **[ソリューション]** の横のドロップダウン リストで、 **[ソリューションに追加]** をクリックします。 このコマンドは、スタティックライブラリを含むソリューションに新しいプロジェクトを追加します。 **[OK]** をクリックします。

1. **[次へ]** をクリックします。

1. **コンソールアプリケーション**が選択されていることを確認します。 次に、 **[空のプロジェクト]** ボックスをオンにし、 **[完了]** を選択します。

::: moniker-end

##  <a name="using-the-functionality-from-the-static-library-in-the-app"></a><a name="UseLibInApp"></a> アプリケーションでのスタティック ライブラリの機能の使用

### <a name="to-use-the-functionality-from-the-static-library-in-the-app"></a>アプリケーションでのスタティック ライブラリの機能を使用するには

1. コンソール アプリケーションを作成すると、空のプログラムが作成されます。 ソース ファイルの名前は、前の処理で付けた名前と同じになります。 この例では、`MyExecRefsLib.cpp`という名前が付けられています。

1. スタティック ライブラリの数値演算ルーチンを使用するには、それを参照する必要があります。 **ソリューションエクスプローラー**で**MyExecRefsLib**プロジェクトのショートカットメニューを開き、[ > **参照**の**追加**] を選択します。

1. **[参照の追加]** ダイアログ ボックスには、参照できるライブラリが表示されます。 **[プロジェクト]** タブには、現在のソリューション内のプロジェクトと、そのプロジェクトが参照しているライブラリが一覧表示されます。 **[プロジェクト]** タブで、 **MathFuncsLib** のチェック ボックスをオンにし、 **[OK]** ボタンをクリックします。

1. `MathFuncsLib.h` ヘッダーファイルを参照するには、含まれているディレクトリパスを変更する必要があります。 **MyExecRefsLib** の **[プロパティ ページ]** ダイアログ ボックスで、 **[構成プロパティ]** ノードを展開し、 **[C/C++]** ノードを展開して、 **[全般]** をクリックします。 **[追加のインクルードディレクトリ]** の横で、 **MathFuncsLib**ディレクトリのパスを指定するか、参照します。

   ディレクトリ パスを参照するには、プロパティ値のドロップダウン リスト ボックスを開き、 **[編集]** をクリックします。 **[追加のインクルードディレクトリ]** ダイアログボックスのテキストボックスで、空白行を選択し、行の末尾にある省略記号ボタン (. **[..]** ) をクリックします。 **[ディレクトリの選択]** ダイアログ ボックスで、 **MathFuncsLib** ディレクトリを選択し、 **[フォルダーの選択]** ボタンをクリックしてその選択を保存し、ダイアログ ボックスを閉じます。 次に **［追加のインクルード ディレクトリ］** ダイアログ ボックスで、 **[OK]** ボタンをクリックし、 **［プロパティ ページ］** ダイアログ ボックスで、 **[OK]** ボタンをクリックしてプロジェクトへの変更を保存します。

1. これで、コードに `#include "MathFuncsLib.h"` ヘッダーを含めることによって、このアプリで `MyMathFuncs` クラスを使用できるようになりました。 `MyExecRefsLib.cpp` の内容を次のコードに置き換えます。

   [!code-cpp[NVC_Walkthrough_Create_Static_Lib#120](../windows/codesnippet/CPP/walkthrough-creating-and-using-a-static-library-cpp_3.cpp)]

1. メニューバーで [**ビルド** > **ビルドソリューション**] を選択して、実行可能ファイルをビルドします。

##  <a name="running-the-app"></a><a name="RunApp"></a> アプリケーションの実行

### <a name="to-run-the-app"></a>アプリケーションを実行するには

1. **ソリューション エクスプローラー** で **MyExecRefsLib** のショートカット メニューを開き、 **[スタートアップ プロジェクトに設定]** をクリックして、 **MyExecRefsLib**が既定のプロジェクトとして選択されていることを確認します。

1. プロジェクトを実行するには、メニュー バーで **[デバッグ]**  >  **[デバッグなしで開始]** の順にクリックします。 出力は次のようになります。

    ```Output
    a + b = 106.4
    a - b = -91.6
    a * b = 732.6
    a / b = 0.0747475
    ```

## <a name="see-also"></a>参照

[チュートリアル: ダイナミック リンク ライブラリの作成と使用 (C++)](../build/walkthrough-creating-and-using-a-dynamic-link-library-cpp.md)<br/>
[デスクトップ アプリケーション (Visual C++)](../windows/desktop-applications-visual-cpp.md)<br/>
