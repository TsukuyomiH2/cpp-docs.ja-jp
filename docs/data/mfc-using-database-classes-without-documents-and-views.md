---
title: 'MFC: ドキュメントとビューを用いないデータベース クラスの使用'
ms.date: 11/04/2016
helpviewer_keywords:
- ODBC applications [C++], without views
- documents [C++], applications without
- ODBC applications [C++]
- document/view architecture [C++], in databases
- files [C++], MFC
- database classes [C++], MFC
- CRecordView class, using in database applications
- database applications [C++], without views
- database applications [C++], application wizard options
- application wizards [C++], creating database applications
- ODBC [C++], file support in database applications
- ODBC applications [C++], without documents
- database applications [C++], without documents
- user interface [C++], drawing information
ms.assetid: 15bf52d4-91cf-4b1d-8b37-87c3ae70123a
ms.openlocfilehash: c914a449b73e7da876d2e05b894c016b53881c3b
ms.sourcegitcommit: c123cc76bb2b6c5cde6f4c425ece420ac733bf70
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/14/2020
ms.locfileid: "81360672"
---
# <a name="mfc-using-database-classes-without-documents-and-views"></a>MFC: ドキュメントとビューを用いないデータベース クラスの使用

場合によっては、データベース アプリケーションでフレームワークのドキュメント/ビュー アーキテクチャを使用したくない場合があります。 このトピックでは、次の内容について説明します。

- ドキュメントのシリアル化などの[ドキュメントを使用する必要がない場合](#_core_when_you_don.92.t_need_documents)。

- [アプリケーション ウィザードのオプション](#_core_appwizard_options_for_documents_and_views)を使用すると、シリアル化を行わず、ドキュメント関連の **[ファイル]** メニューコマンド **([新規作成**]、[**開く**]、[**上書**き保存]、および **[名前を付けて保存]** など) を使用せずにアプリケーションをサポートできます。

- [最小限のドキュメントを使用するアプリケーションを操作する方法](#_core_applications_with_minimal_documents):

- [ドキュメントやビューを使用しないアプリケーションを構築する方法](#_core_applications_with_no_document)。

## <a name="when-you-do-not-need-documents"></a><a name="_core_when_you_don.92.t_need_documents"></a>書類が不要な場合

アプリケーションによっては、ドキュメントの概念が明確に異なる場合があります。 これらのアプリケーションは、通常 **、File Open**コマンドを使用して、ストレージからすべてのファイルまたはほとんどのファイルをメモリにロードします。 更新されたファイルは、[ファイルの**保存**] または [名前を**付けて保存]** コマンドを使用して一度にストレージに書き戻されます。 ユーザーに表示されるデータ ファイルです。

ただし、アプリケーションのカテゴリによっては、ドキュメントを必要としないものもあります。 データベース アプリケーションは、トランザクションの観点から動作します。 アプリケーションはデータベースからレコードを選択し、ユーザーに対して(多くの場合、一度に 1 つずつ) 表示します。 ユーザーが見ているのは、通常、メモリ内の唯一のレコードである可能性がある 1 つの現在のレコードです。

アプリケーションでデータを格納するためのドキュメントが不要な場合は、フレームワークのドキュメント/ビュー アーキテクチャの一部またはすべてを使用できます。 あなたがどれだけ分配するかは、あなたが好むアプローチによって異なります。 次の場合があります。

- 最小限のドキュメントを使用して、データ ソースへの接続を保存する場所として、シリアル化などの通常のドキュメント機能を使用します。 これは、データの複数のビューが必要で、すべてのビューを同期して一度に更新する場合などに便利です。

- ビューを使用するのではなく、直接描画するフレーム ウィンドウを使用します。 この場合、ドキュメントを省略し、フレーム ウィンドウ オブジェクトにデータまたはデータ接続を格納します。

## <a name="application-wizard-options-for-documents-and-views"></a><a name="_core_appwizard_options_for_documents_and_views"></a>ドキュメントとビューのアプリケーション ウィザード オプション

MFC アプリケーション ウィザードの **[データベース サポートの選択]** には、次の表に示すいくつかのオプションがあります。 MFC アプリケーション ウィザードを使用してアプリケーションを作成すると、これらのオプションはすべてドキュメントとビューを含むアプリケーションを生成します。 一部のオプションでは、不要なドキュメント機能を省略したドキュメントとビューを提供します。 詳細については、「[データベース サポート 、 MFC アプリケーション ウィザード](../mfc/reference/database-support-mfc-application-wizard.md)」を参照してください。

|オプション|表示|ドキュメント|
|------------|----------|--------------|
|**なし**|`CView`の派生クラスです。|データベースサポートはありません。 既定のオプションです。<br /><br /> [[アプリケーションの種類]、MFC アプリケーション ウィザード](../mfc/reference/application-type-mfc-application-wizard.md)ページで[**ドキュメント/ビュー アーキテクチャのサポート**]オプションを選択すると、[**ファイル]** メニューの [**新規作成**]、[**開く**]、[**保存]、[名前**を**付けて保存**] などのドキュメントの完全なサポートが得られます。 [「ドキュメントのないアプリケーション」を](#_core_applications_with_no_document)参照してください。|
|**ヘッダー ファイルのみ**|`CView`の派生クラスです。|アプリケーションのデータベース サポートの基本レベルを提供します。<br /><br /> Afxdb.h が含まれています。 リンク ライブラリを追加しますが、データベース固有のクラスは作成しません。 レコードセットは後で作成し、レコードの調査や更新に使用できます。|
|**ファイルサポートなしのデータベース ビュー**|から派生`CRecordView`|ドキュメントのサポートは提供されますが、シリアル化はサポートされません。 ドキュメントはレコードセットを格納し、複数のビューを調整できます。シリアル化、**新規作成**、**開く**、**保存**、および名前を**付けて保存**コマンドはサポートされていません。 [最小限のドキュメントを含むアプリケーションを](#_core_applications_with_minimal_documents)参照してください。 データベース ビューを含める場合は、データのソースを指定する必要があります。<br /><br /> データベース ヘッダー ファイル、リンク ライブラリ、レコード ビュー、およびレコードセットが含まれます。 ([アプリケーションの種類] の[[MFC](../mfc/reference/application-type-mfc-application-wizard.md)アプリケーション ウィザード] ページで **[ドキュメント/ビュー アーキテクチャ**のサポート] オプションが選択されているアプリケーションでのみ使用できます)。|
|**ファイルサポートを含むデータベース ビュー**|から派生`CRecordView`|シリアル化やドキュメント関連の **[ファイル]** メニュー コマンドなど、ドキュメントの完全なサポートを提供します。 データベース アプリケーションは、通常、ファイル単位ではなくレコード単位で動作するため、シリアル化は不要です。 ただし、シリアル化には特別な用途があります。 [最小限のドキュメントを含むアプリケーションを](#_core_applications_with_minimal_documents)参照してください。 データベース ビューを含める場合は、データのソースを指定する必要があります。<br /><br /> データベース ヘッダー ファイル、リンク ライブラリ、レコード ビュー、およびレコードセットが含まれます。 ([アプリケーションの種類] の[[MFC](../mfc/reference/application-type-mfc-application-wizard.md)アプリケーション ウィザード] ページで **[ドキュメント/ビュー アーキテクチャ**のサポート] オプションが選択されているアプリケーションでのみ使用できます)。|

シリアル化の代替方法とシリアル化の代替方法については、「[シリアル化: シリアル化とデータベースの入出力](../mfc/serialization-serialization-vs-database-input-output.md)」を参照してください。

## <a name="applications-with-minimal-documents"></a><a name="_core_applications_with_minimal_documents"></a>最小限のドキュメントを含むアプリケーション

MFC アプリケーション ウィザードには、フォーム ベースのデータ アクセス アプリケーションをサポートする 2 つのオプションがあります。 各オプションは、`CRecordView`派生ビュー クラスとドキュメントを作成します。 彼らは文書から残すものが異なります。

### <a name="document-without-file-support"></a><a name="_core_a_document_without_file_support"></a>ファイルサポートなしのドキュメント

ドキュメントのシリアル化が不要な場合は、アプリケーション ウィザード のデータベース オプション **[ファイルサポートなしのデータベース ビュー** ] を選択します。 このドキュメントは、次の便利な目的で使用されます。

- オブジェクトを格納するのに便利な`CRecordset`場所です。

   この使用法は、通常のドキュメント概念と並行して、データ (この場合はレコードのセット) をドキュメントに格納し、ビューはドキュメントのビューです。

- アプリケーションで複数のビュー (複数のレコード ビューなど) が表示される場合、ドキュメントはビューの調整をサポートします。

   複数のビューに同じデータが表示される場合は`CDocument::UpdateAllViews`、いずれかのビューでデータが変更されたときに、メンバー関数を使用してすべてのビューの更新を調整できます。

このオプションは、通常、単純なフォームベースのアプリケーションに使用します。 アプリケーション ウィザードは、このようなアプリケーションに対して便利な構造を自動的にサポートします。

### <a name="document-with-file-support"></a><a name="_core_a_document_with_file_support"></a>ファイルサポート付きドキュメント

ドキュメント関連の **[ファイル**] メニュー コマンドとドキュメントのシリアル化に代わる方法がある場合は、アプリケーション ウィザード のデータベース オプション [**データベース ビュー** ] を選択し、ファイルサポートを使用します。 プログラムのデータ アクセス部分については、「[ファイル サポートなしのドキュメント](#_core_a_document_without_file_support)」で説明されているのと同じ方法でドキュメントを使用できます。 ドキュメントのシリアル化機能を使用して、ユーザーの基本設定やその他の有用な情報を格納するシリアル化されたユーザー プロファイル ドキュメントの読み書きなどを行うことができます。 その他の方法については、「[シリアル化: シリアル化とデータベースの入出力](../mfc/serialization-serialization-vs-database-input-output.md)」を参照してください。

アプリケーション ウィザードではこのオプションがサポートされていますが、ドキュメントをシリアル化するコードを記述する必要があります。 シリアル化された情報をドキュメント データ メンバーに格納します。

## <a name="applications-with-no-document"></a><a name="_core_applications_with_no_document"></a>ドキュメントのないアプリケーション

ドキュメントやビューを使用しないアプリケーションを作成したい場合があります。 ドキュメントを使用しない場合、`CRecordset`データ (オブジェクトなど) は、フレーム ウィンドウ クラスまたはアプリケーション クラスに格納されます。 追加の要件は、アプリケーションがユーザー インターフェイスを提供するかどうかによって異なります。

### <a name="database-support-with-a-user-interface"></a><a name="_core_database_support_with_a_user_interface"></a>ユーザー インターフェイスを使用したデータベースサポート

ユーザー インターフェイス (コンソール コマンド ライン インターフェイスなど) がある場合、アプリケーションはビューではなくフレーム ウィンドウのクライアント領域に直接描画します。 このようなアプリケーションは、 、`CRecordView``CFormView`または`CDialog`、メイン ユーザー インターフェイスには使用しませんが、通常は`CDialog`通常、通常、ダイアログ に使用されます。

### <a name="writing-applications-without-documents"></a><a name="_core_writing_applications_without_documents"></a>ドキュメントを使用しないアプリケーションの作成

アプリケーション ウィザードではドキュメントを使用しないアプリケーションの作成はサポートされていないため、独自`CWinApp`の派生クラスを記述し、必要に応じて`CFrameWnd`or`CMDIFrameWnd`クラスも作成する必要があります。 アプリケーション`CWinApp::InitInstance`オブジェクトをオーバーライドして宣言します。

```cpp
CYourNameApp theApp;
```

フレームワークは、メッセージ マップ メカニズムと他の多くの機能を提供します。

### <a name="database-support-separate-from-the-user-interface"></a><a name="_core_database_support_separate_from_the_user_interface"></a>ユーザー インターフェイスとは別のデータベース サポート

一部のアプリケーションでは、ユーザー インターフェイスを必要としないか、最小限のインターフェイスのみを必要とします。 たとえば、次のような記述を行っているとします。

- 他のアプリケーション (クライアント) が、アプリケーションとデータ ソースの間でデータの特別な処理を呼び出す中間データ アクセス オブジェクト。

- あるデータベース形式から別のデータベース形式にデータを移動するアプリケーションや、計算を実行してバッチ更新を実行するアプリケーションなど、ユーザーの介入なしにデータを処理するアプリケーション。

オブジェクトを所有する`CRecordset`ドキュメントがないため、オブジェクトを、派生アプリケーション クラスに埋め込みデータ`CWinApp`メンバーとして格納する必要があります。 代替案は次のとおりです。

- 永久的`CRecordset`なオブジェクトをまったく保持していません。 NULL をレコードセット クラスのコンストラクターに渡すことができます。 その場合、フレームワークは、レコードセットの`CDatabase``GetDefaultConnect`メンバー関数の情報を使用して一時オブジェクトを作成します。 これは、最も可能性の高い代替アプローチです。

- オブジェクトを`CRecordset`グローバル変数にします。 この変数は、オーバーライドで動的に作成するレコードセット オブジェクトへのポインターである`CWinApp::InitInstance`必要があります。 これにより、フレームワークが初期化される前にオブジェクトを構築しようとするのを回避できます。

- ドキュメントまたはビューのコンテキスト内でのレコードセット オブジェクトの使用。 アプリケーションオブジェクトまたはフレームウィンドウオブジェクトのメンバー関数にレコードセットを作成します。

## <a name="see-also"></a>関連項目

[MFC データベース クラス](../data/mfc-database-classes-odbc-and-dao.md)
