---
title: 'MFC: ドキュメントとビューを用いないデータベース クラスの使用'
ms.date: 11/04/2016
helpviewer_keywords:
- ODBC applications [C++], without views
- documents [C++], applications without
- ODBC applications [C++]
- document/view architecture [C++], in databases
- files [C++], MFC
- database classes [C++], MFC
- CRecordView class, using in database applications
- database applications [C++], without views
- database applications [C++], application wizard options
- application wizards [C++], creating database applications
- ODBC [C++], file support in database applications
- ODBC applications [C++], without documents
- database applications [C++], without documents
- user interface [C++], drawing information
ms.assetid: 15bf52d4-91cf-4b1d-8b37-87c3ae70123a
ms.openlocfilehash: 57a7abd89bc9bfb465912a35c21f9780668f4466
ms.sourcegitcommit: 857fa6b530224fa6c18675138043aba9aa0619fb
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/24/2020
ms.locfileid: "80213357"
---
# <a name="mfc-using-database-classes-without-documents-and-views"></a>MFC: ドキュメントとビューを用いないデータベース クラスの使用

場合によっては、データベースアプリケーションでフレームワークのドキュメント/ビューアーキテクチャを使用しないことがあります。 このトピックでは、次の内容について説明します。

- ドキュメントのシリアル化などの[ドキュメントを使用する必要がない場合](#_core_when_you_don.92.t_need_documents)。

- **[新規]** 、 **[開く**]、 **[保存]** 、名前を付け **[て保存]** などのドキュメント関連の**ファイル**メニューコマンドを使用せずに、シリアル化を行わずにアプリケーションをサポートする[アプリケーションウィザードオプション](#_core_appwizard_options_for_documents_and_views)。

- [最小限のドキュメントを使用するアプリケーションを操作する方法](#_core_applications_with_minimal_documents)。

- [ドキュメントまたはビューを使用せずにアプリケーションを構造化する方法](#_core_applications_with_no_document)。

##  <a name="when-you-do-not-need-documents"></a><a name="_core_when_you_don.92.t_need_documents"></a>ドキュメントが不要な場合

アプリケーションによっては、ドキュメントの概念が異なります。 これらのアプリケーションは、通常、**ファイルを開く**コマンドを使用して、ストレージからすべてのファイルまたはほとんどのファイルをメモリに読み込みます。 **ファイルの保存**または **[名前を付けて保存]** コマンドを使用して、更新されたファイルをストレージに一度に書き戻します。 ユーザーに表示されるのはデータファイルです。

ただし、アプリケーションのカテゴリによっては、ドキュメントは必要ありません。 データベースアプリケーションはトランザクションとして動作します。 アプリケーションは、データベースからレコードを選択し、ユーザーに表示します。多くの場合、一度に1つずつ表示されます。 通常、ユーザーに表示されるのは、1つの現在のレコードです。これは、メモリ内に1つしか存在しない可能性があります。

アプリケーションでデータを格納するためのドキュメントが不要な場合は、フレームワークのドキュメント/ビューアーキテクチャの一部またはすべてを使用することができます。 どのくらいの方法を使用するかは、希望する方法によって異なります。 次のような場合があります。

- データソースへの接続を格納する場所として最小限のドキュメントを使用しますが、シリアル化などの通常のドキュメント機能を使用することはできません。 これは、データの複数のビューが必要で、すべてのビューを同期し、一度にすべて更新する必要がある場合に便利です。

- ビューを使用するのではなく、直接描画するフレームウィンドウを使用します。 この場合は、ドキュメントを省略し、データまたはデータ接続をフレームウィンドウオブジェクトに格納します。

##  <a name="application-wizard-options-for-documents-and-views"></a><a name="_core_appwizard_options_for_documents_and_views"></a>ドキュメントとビューのアプリケーションウィザードオプション

MFC アプリケーションウィザードには、次の表に示す **[データベースサポートの選択]** のオプションがいくつかあります。 MFC アプリケーションウィザードを使用してアプリケーションを作成する場合、これらのすべてのオプションによって、ドキュメントとビューを含むアプリケーションが生成されます。 一部のオプションには、不要なドキュメント機能を省略するドキュメントとビューが用意されています。 詳細については、「[データベースサポート、MFC アプリケーションウィザード](../mfc/reference/database-support-mfc-application-wizard.md)」を参照してください。

|オプション|表示|ドキュメント|
|------------|----------|--------------|
|**なし**|`CView`の派生クラスです。|では、データベースのサポートは提供されません。 既定のオプションです。<br /><br /> [アプリケーションの種類] の [ [MFC アプリケーションウィザード](../mfc/reference/application-type-mfc-application-wizard.md)] ページで **[ドキュメント/ビューアーキテクチャのサポート]** オプションを選択すると、 **[ファイル]** メニューに シリアル化、 **[新規]** 、 **[開く**]、 **[保存]** 、名前を付け **[て保存]** の各コマンドが表示されます。 「[ドキュメントのないアプリケーション」を](#_core_applications_with_no_document)参照してください。|
|**ヘッダーファイルのみ**|`CView`の派生クラスです。|アプリケーションのデータベースサポートの基本レベルを提供します。<br /><br /> には Afxdb.h が含まれます。 リンクライブラリを追加しますが、データベース固有のクラスは作成しません。 後でレコードセットを作成し、それらを使用してレコードを検査および更新することができます。|
|**ファイルサポートのないデータベースビュー**|`CRecordView` からの派生|ドキュメントサポートを提供しますが、シリアル化はサポートしていません。 ドキュメントでは、レコードセットを格納し、複数のビューを調整できます。は、シリアル化、または **[新規]** 、 **[開く]** 、 **[保存]** 、名前を付け **[て保存]** コマンドをサポートしていません。 「[最小限のドキュメントを含むアプリケーション」を](#_core_applications_with_minimal_documents)参照してください。 データベースビューを含める場合は、データのソースを指定する必要があります。<br /><br /> には、データベースヘッダーファイル、リンクライブラリ、レコードビュー、およびレコードセットが含まれています。 ([[アプリケーションの種類] の [MFC アプリケーションウィザード](../mfc/reference/application-type-mfc-application-wizard.md)] ページで **[ドキュメント/ビューアーキテクチャのサポート]** オプションが選択されているアプリケーションでのみ使用できます。)|
|**ファイルサポートのあるデータベースビュー**|`CRecordView` からの派生|シリアル化やドキュメント関連の**ファイル**メニューコマンドなど、ドキュメント全体のサポートを提供します。 データベースアプリケーションは、通常、ファイル単位ではなくレコード単位で処理されるため、シリアル化は必要ありません。 ただし、シリアル化に特別な用途がある場合もあります。 「[最小限のドキュメントを含むアプリケーション」を](#_core_applications_with_minimal_documents)参照してください。 データベースビューを含める場合は、データのソースを指定する必要があります。<br /><br /> には、データベースヘッダーファイル、リンクライブラリ、レコードビュー、およびレコードセットが含まれています。 ([[アプリケーションの種類] の [MFC アプリケーションウィザード](../mfc/reference/application-type-mfc-application-wizard.md)] ページで **[ドキュメント/ビューアーキテクチャのサポート]** オプションが選択されているアプリケーションでのみ使用できます。)|

シリアル化の代替方法と、シリアル化の代替の使用方法の詳細については、「[シリアル化: シリアル](../mfc/serialization-serialization-vs-database-input-output.md)化とデータベースの入出力」を参照してください。

##  <a name="applications-with-minimal-documents"></a><a name="_core_applications_with_minimal_documents"></a>最小限のドキュメントを含むアプリケーション

MFC アプリケーションウィザードには、フォームベースのデータアクセスアプリケーションをサポートする2つのオプションがあります。 各オプションでは、`CRecordView`派生ビュークラスとドキュメントが作成されます。 ドキュメントから出てくるものとは異なります。

###  <a name="document-without-file-support"></a><a name="_core_a_document_without_file_support"></a>ファイルサポートのないドキュメント

ドキュメントのシリアル化が不要な場合は、アプリケーションウィザードのデータベースオプション**データベースビュー**を選択します。 このドキュメントでは、次の便利な目的について説明します。

- これは、`CRecordset` オブジェクトを格納するのに便利な場所です。

   この使用方法は、通常のドキュメントの概念に匹敵します。ドキュメントでは、データ (この場合はレコードのセット) とビューがドキュメントのビューに格納されます。

- アプリケーションが複数のビュー (複数のレコードビューなど) を表示する場合、ドキュメントはビューの調整をサポートします。

   複数のビューで同じデータが表示されている場合は、`CDocument::UpdateAllViews` メンバー関数を使用して、任意のビューがデータを変更したときに、すべてのビューの更新を調整できます。

このオプションは、通常、単純なフォームベースのアプリケーションに使用します。 アプリケーションウィザードは、このようなアプリケーションのための便利な構造を自動的にサポートします。

###  <a name="document-with-file-support"></a><a name="_core_a_document_with_file_support"></a>ファイルのサポートがあるドキュメント

ドキュメント関連の **[ファイル]** メニューのコマンドとドキュメントのシリアル化を別の方法で使用する場合は、アプリケーションウィザードの データベースの **[表示]** オプションを選択します。 プログラムのデータアクセス部分では、「[ファイルサポートなしのドキュメント](#_core_a_document_without_file_support)」で説明されているのと同じ方法でドキュメントを使用できます。 たとえば、ドキュメントのシリアル化機能を使用して、ユーザーの設定やその他の有用な情報を格納する、シリアル化されたユーザープロファイルドキュメントの読み取りと書き込みを行うことができます。 詳細については、「[シリアル化: シリアル化とデータベースの入出力](../mfc/serialization-serialization-vs-database-input-output.md)」を参照してください。

アプリケーションウィザードではこのオプションがサポートされていますが、ドキュメントをシリアル化するコードを記述する必要があります。 ドキュメントデータメンバーにシリアル化された情報を格納します。

##  <a name="applications-with-no-document"></a><a name="_core_applications_with_no_document"></a>ドキュメントのないアプリケーション

ドキュメントやビューを使用しないアプリケーションを作成することが必要になる場合があります。 ドキュメントを使用しない場合は、データ (`CRecordset` オブジェクトなど) をフレームウィンドウクラスまたはアプリケーションクラスに格納します。 その他の要件は、アプリケーションがユーザーインターフェイスを提示するかどうかによって異なります。

###  <a name="database-support-with-a-user-interface"></a><a name="_core_database_support_with_a_user_interface"></a>ユーザーインターフェイスを使用したデータベースのサポート

ユーザーインターフェイス (コンソールのコマンドラインインターフェイスなど) がある場合、アプリケーションは、ビューではなく、フレームウィンドウのクライアント領域に直接描画します。 このようなアプリケーションでは、メインのユーザーインターフェイスに `CRecordView`、`CFormView`、または `CDialog` を使用しませんが、通常のダイアログには通常 `CDialog` を使用します。

###  <a name="writing-applications-without-documents"></a><a name="_core_writing_applications_without_documents"></a>ドキュメントを使用しないアプリケーションの作成

アプリケーションウィザードでは、ドキュメントを使用しないアプリケーションの作成はサポートされていないため、独自の `CWinApp`派生クラスを記述し、必要に応じて `CFrameWnd` または `CMDIFrameWnd` クラスも作成する必要があります。 `CWinApp::InitInstance` をオーバーライドし、次のようにアプリケーションオブジェクトを宣言します。

```cpp
CYourNameApp theApp;
```

フレームワークは依然として、メッセージマップ機構とその他多くの機能を提供します。

###  <a name="database-support-separate-from-the-user-interface"></a><a name="_core_database_support_separate_from_the_user_interface"></a>ユーザーインターフェイスとは別のデータベースサポート

アプリケーションによっては、ユーザーインターフェイスを必要としないアプリケーションや、最小限のアプリケーションを必要とするものがあります たとえば、次のように記述しているとします。

- 他のアプリケーション (クライアント) が、アプリケーションとデータソース間のデータの特別な処理を行うために呼び出す中間データアクセスオブジェクト。

- あるデータベース形式から別のデータベース形式にデータを移動するアプリケーションや、計算を実行してバッチ更新を実行するアプリケーションなど、ユーザーの介入なしにデータを処理するアプリケーション。

`CRecordset` オブジェクトを所有しているドキュメントがないため、`CWinApp`派生アプリケーションクラスに埋め込みデータメンバーとして格納することをお勧めします。 代替手段は次のとおりです。

- 永続的な `CRecordset` オブジェクトを保持することはできません。 NULL をレコードセットクラスのコンストラクターに渡すことができます。 その場合、フレームワークは、レコードセットの `GetDefaultConnect` メンバー関数の情報を使用して、一時 `CDatabase` オブジェクトを作成します。 これは、最も可能性の高い代替方法です。

- `CRecordset` オブジェクトをグローバル変数にします。 この変数は、`CWinApp::InitInstance` オーバーライドで動的に作成するレコードセットオブジェクトへのポインターである必要があります。 これにより、フレームワークが初期化される前にオブジェクトを構築しようとすることを回避できます。

- ドキュメントまたはビューのコンテキスト内でのレコードセットオブジェクトの使用。 アプリケーションまたはフレームウィンドウオブジェクトのメンバー関数にレコードセットを作成します。

## <a name="see-also"></a>参照

[MFC データベース クラス](../data/mfc-database-classes-odbc-and-dao.md)
