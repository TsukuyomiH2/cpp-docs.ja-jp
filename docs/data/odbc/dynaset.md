---
title: ダイナセット
ms.date: 11/04/2016
helpviewer_keywords:
- ODBC recordsets, dynasets
- ODBC cursor library [ODBC], dynasets
- keyset-driven cursors in dynasets
- cursors [ODBC], keyset-driven cursors in dynasets
- cursor library [ODBC], dynaset availability
- recordsets [C++], dynasets
- dynasets
ms.assetid: 2867e6be-208e-4fe7-8bbe-b8697cb1045c
ms.openlocfilehash: 2eb2447d1f984b7734d5e9c45087023e5a6f003f
ms.sourcegitcommit: c123cc76bb2b6c5cde6f4c425ece420ac733bf70
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/14/2020
ms.locfileid: "81371837"
---
# <a name="dynaset"></a>ダイナセット

このトピックでは、ダイナセットについて説明し、その[可用性](#_core_availability_of_dynasets)について説明します。

> [!NOTE]
> このトピックは[、CRecordset](../../mfc/reference/crecordset-class.md)を含む MFC ODBC クラスに適用されます。 DAO クラスのダイナセットの詳細については、「 [CDaoRecordset](../../mfc/reference/cdaorecordset-class.md)」を参照してください。 DAO を使用すると、ダイナセット タイプのレコードセットを開くことができます。

ダイナセットは、動的プロパティを持つレコードセットです。 その有効期間中、ダイナセット モード (通常はダイナセット) のレコードセット オブジェクトは、次のようにデータ ソースと同期されたままになります。 マルチユーザー環境では、他のユーザーがダイナセット内のレコードを編集または削除したり、ダイナセットが表すテーブルにレコードを追加したりする可能性があります。 アプリケーションがレコードセットに追加またはレコードセットから削除したレコードは、ダイナセットに反映されます。 他のユーザーがテーブルに追加したレコードは、そのメンバー関数を呼び出してダイナセットを再構築するまで、ダイ`Requery`ナセットに反映されません。 他のユーザーがレコードを削除すると、MFC コードはレコードセット内の削除をスキップします。 影響を受けるレコードにスクロールすると、他のユーザーによる既存のレコードへの編集の変更がダイナセットに反映されます。

同様に、ダイナセット内のレコードに対して行った編集は、他のユーザが使用しているダイナセットにも反映されます。 追加したレコードは、ダイナセットを再クエリするまで、他のユーザのダイナセットには反映されません。 削除したレコードは、他のユーザーのレコードセットで "削除済み" としてマークされます。 同じデータベース (複数`CDatabase`のオブジェクト) に複数の接続がある場合、それらの接続に関連付けられたレコードセットは、他のユーザーのレコードセットと同じ状態になります。

ダイナセットは、航空予約システムでのデータ(たとえば)のように動的でなければならない場合に最も価値があります。

> [!NOTE]
> ダイナセットを使用するには、ダイナセットをサポートするデータ ソース用の ODBC ドライバが必要であり、ODBC カーソル ライブラリをロードしないでください。 詳細については、「[ダイナセットの可用性](#_core_availability_of_dynasets)」を参照してください。

レコードセットがダイナセットであることを指定するには、最初の`CRecordset::dynaset`パラメータとしてレコードセット オブジェクト`Open`のメンバー関数に渡します。

> [!NOTE]
> 更新可能ダイナセットの場合、ODBC ドライバーは位置指定更新ステートメントまたは ODBC `::SQLSetPos` API 関数をサポートする必要があります。 両方がサポートされている場合、MFC`::SQLSetPos`は効率を高めます。

## <a name="availability-of-dynasets"></a><a name="_core_availability_of_dynasets"></a>ダイナセットの可用性

MFC データベース クラスは、次の要件が満たされている場合にダイナセットをサポートします。

- ODBC カーソル ライブラリ DLL は、このデータ ソースに使用できません。

   カーソル ライブラリを使用する場合は、ダイナセットのサポートに必要な、基になる ODBC ドライバーの機能の一部をマスクします。 ダイナセットを使用する場合 (および、このセクションの残りの部分で説明するように、ダイナセットに必要な機能を持つ ODBC ドライバー)、オブジェクトの作成時に MFC が`CDatabase`カーソル ライブラリを読み込まないようにすることができます。 詳細については[、ODBC](../../data/odbc/odbc-basics.md)とクラス`CDatabase`の[OpenEx](../../mfc/reference/cdatabase-class.md#openex)または[Open](../../mfc/reference/cdatabase-class.md#open)メンバー関数を参照してください。

   ODBC 用語では、ダイナセットとスナップショットはカーソルと呼ばれます。 カーソルは、レコードセット内での位置を追跡するために使用されるメカニズムです。

- データ ソースの ODBC ドライバーは、キーセット ドリブン カーソルをサポートする必要があります。

   キーセット ドリブン カーソルは、キーのセットを取得および格納することによって、テーブルのデータを管理します。 キーは、ユーザーが特定のレコードにスクロールするときに、テーブルから現在のデータを取得するために使用されます。 ドライバーがこのサポートを提供するかどうかを確認するには *、SQL_SCROLL_OPTIONS* `::SQLGetInfo`パラメーターを使用して ODBC API 関数を呼び出します。

   キーセットをサポートせずにダイナセットを開こうとすると、リターンコード値の`CDBException`を取得AFX_SQL_ERROR_DYNASET_NOT_SUPPORTED。

- データ ソースの ODBC ドライバーは、拡張フェッチをサポートしている必要があります。

   拡張フェッチは、SQL クエリの結果レコードを前方にスクロールする機能です。 ドライバーがこの機能をサポートしているかどうかを確認するには *、SQL_API_SQLEXTENDEDFETCH* `::SQLGetFunctions`パラメーターを指定して ODBC API 関数を呼び出します。

更新可能なダイナセット (またはスナップショット) が必要な場合は、ODBC ドライバーも ODBC `::SQLSetPos` API 関数または位置指定更新をサポートする必要があります。 この`::SQLSetPos`関数を使用すると、SQL ステートメントを送信せずに、MFC でデータ ソースを更新できます。 このサポートが利用可能な場合、MFC は SQL を使用して更新を行う場合に使用します。 ドライバーが をサポート`::SQLSetPos`しているかどうかを確認するには`::SQLGetInfo`*、SQL_POS_OPERATIONS*パラメーターを指定して呼び出します。

位置指定更新では、SQL 構文 **(WHERE CURRENT OF**\<カーソル名>) を使用して、データ ソース上のテーブル内の特定の行を識別します。 ドライバーが位置付け更新をサポートしているかどうかを確認`::SQLGetInfo`するには *、SQL_POSITIONED_STATEMENTS*パラメーターを呼び出します。

一般に、MFC ダイナセット (前方専用レコードセットではない) には、レベル 2 の API 準拠の ODBC ドライバが必要です。 データ ソースのドライバーがレベル 1 の API セットに準拠している場合でも、更新可能なスナップショットと読み取り専用スナップショットと前方専用レコードセットの両方を使用できますが、ダイナセットは使用できません。 ただし、レベル 1 ドライバーは、拡張フェッチおよびキーセット ドリブン カーソルをサポートする場合は、ダイナセットをサポートできます。 ODBC 準拠レベルの詳細については[、「ODBC」](../../data/odbc/odbc-basics.md)を参照してください。

> [!NOTE]
> スナップショットとダイナセットの両方を使用する場合は、2 つの異なるオブジェクト`CDatabase`(2 つの異なる接続) に基づいて作成する必要があります。

ODBC カーソル ライブラリによって保持される中間ストレージを使用するスナップショットとは異なり、ダイナセットは、データ ソースにスクロールするとすぐにデータ ソースから直接レコードをフェッチします。 これにより、ダイナセットによって最初に選択されたレコードがデータ ソースと同期された状態に維持されます。

Visual C++ のこのバージョンに含まれている ODBC ドライバー一覧、および他のドライバーを取得する方法については、「[ODBC ドライバーの一覧](../../data/odbc/odbc-driver-list.md)」を参照してください。

## <a name="see-also"></a>関連項目

[データベース接続を開く (ODBC)](../../data/odbc/open-database-connectivity-odbc.md)
