---
title: 単純なコンシューマーの作成
ms.date: 05/09/2019
helpviewer_keywords:
- OLE DB consumers, creating
ms.assetid: ae32d657-72ea-4db8-9839-75cb5cff68ae
ms.openlocfilehash: 0b142a73f66a796f3e22bae0aeacb88dc018aea9
ms.sourcegitcommit: a1676bf6caae05ecd698f26ed80c08828722b237
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 09/29/2020
ms.locfileid: "91501861"
---
# <a name="creating-a-simple-consumer"></a>単純なコンシューマーの作成

::: moniker range="vs-2019"

ATL OLE DB コンシューマー ウィザードは、Visual Studio 2019 以降では使用できません。 ただし、この機能を手動で追加することは可能です。 詳細については、「[ウィザードを使用しないコンシューマーの作成](creating-a-consumer-without-using-a-wizard.md)」をご覧ください。

::: moniker-end

::: moniker range="<=vs-2017"

**ATL プロジェクト ウィザード**と **ATL OLE DB コンシューマー ウィザード**を使用して OLE DB テンプレート コンシューマーを生成します。

## <a name="to-create-a-console-application-for-an-ole-db-consumer"></a>OLE DB コンシューマー用のコンソール アプリケーションを作成するには

1. **[ファイル]** メニューの **[新規作成]** をクリックし、**[プロジェクト]** をクリックします。

   **[新しいプロジェクト]** ダイアログ ボックスが表示されます。

1. **[プロジェクトの種類]** ウィンドウで **[インストール済み]** > **[Visual C++]** > **[Windows デスクトップ]** フォルダーをクリックし、**[テンプレート]** ウィンドウの **[Windows デスクトップ ウィザード]** アイコンをクリックします。 **[名前]** ボックスにプロジェクト名を入力します (例: *MyCons*)。

1. **[OK]** をクリックします。

   **Windows デスクトップ プロジェクト** ウィザードが起動します。

1. **[アプリケーションの設定]** ページで **[コンソール アプリケーション]** を選択し、**[共通ヘッダー ファイルを追加: ATL]** を選択します。

1. **[OK]** をクリックし、ウィザードを終了してプロジェクトを生成します。

次に、**ATL OLE DB コンシューマー ウィザード**を使用して OLE DB コンシューマー オブジェクトを追加します。

## <a name="to-create-a-consumer-with-the-atl-ole-db-consumer-wizard"></a>ATL OLE DB コンシューマー ウィザードを使用してコンシューマーを作成するには

1. **ソリューションエクスプローラー**で、プロジェクトを右クリックし `MyCons` ます。

1. ショートカット メニューの **[追加]**、**[新しい項目]** を順にクリックします。

   **[新しい項目の追加]** ダイアログ ボックスが表示されます。

1. **[カテゴリ]** ウィンドウで **[インストール済み]** > **[Visual C++]** > **[ATL]** をクリックし、**[テンプレート]** ウィンドウの **[ATL OLEDB コンシューマー]** アイコンをクリックして、**[追加]** をクリックします。

   **ATL OLEDB コンシューマー ウィザード**が起動します。

1. **[データ ソース]** ボタンをクリックします。

   **[データ リンク プロパティ]** ダイアログ ボックスが表示されます。

1. **[データ リンク プロパティ]** ダイアログ ボックスで次の操作を行います。

   1. **[プロバイダー]** タブで、OLE DB プロバイダーを指定します。

   1. **[接続]** タブで、サーバー名、ログオン ID、パスワードなど、サーバー上のデータ ソースとデータベースに必要な情報を指定します。

      > [!NOTE]
      > **[データ リンク プロパティ]** ダイアログ ボックスの **[パスワードを保存する]** 機能には、セキュリティ上の問題があります。 [ **サーバーにログオンするための情報を入力**してください] には、2つのオプションボタンがあります。 **Windows NT 統合セキュリティを使用** し、特定の **ユーザー名とパスワードを使用**します。

      > [!NOTE]
      > **[特定のユーザー名とパスワードを使用する]** を選択した場合、パスワードを保存するオプション (**[パスワードを保存する]** チェック ボックスを使用) がありますが、このオプションは安全ではありません。 **[Windows NT の統合セキュリティを使用する]** を選択することをお勧めします。このオプションでは、Windows NT を使用してユーザーの ID を確認します。

      > [!NOTE]
      > Windows NT の統合セキュリティを使用できない場合は、中間層アプリケーションを使用して、ユーザーにパスワードの入力を求めるか、パスワードを (ソース コードではなく) セキュリティ機構が備わった場所に保管して保護する必要があります。

   1. プロバイダーとその他の設定を選択したら、**[接続テスト]** をクリックして、前のダイアログ ボックスのページで選択した内容を検証します。 **[結果]** ボックスに「`Test connection succeeded`」と表示されたら、**[OK]** をクリックしてデータ リンクを作成します。

   **[データベース オブジェクトの選択]** ダイアログ ボックスが表示されます。

1. ツリー コントロールを使用して、テーブル、ビュー、またはストアド プロシージャを選択します。 この例では、`Northwind` データベースの `Products` テーブルを選択します。

1. **[OK]** をクリックします。 これにより、**ATL OLE DB コンシューマー ウィザード**に戻ります。

1. 選択したテーブル、ビュー、またはストアド プロシージャの名前に基づいて、`Class` と **.h ファイル**の名前がウィザードによって補完されます。 これらの名前は必要に応じて編集できます。

1. **[属性]** チェック ボックスをオフにして、ウィザードで既定の [OLE DB コンシューマー属性](../../windows/attributes/ole-db-consumer-attributes.md)ではなく、[OLE DB テンプレート クラス](../../data/oledb/ole-db-consumer-templates-reference.md)を使用してコンシューマー コードが作成されるようにします。

1. **[型]** で **[コマンド]** を選択します。

   **[コマンド]** を選択した場合は [CCommand](../../data/oledb/ccommand-class.md) ベースのコンシューマーが、**[テーブル]** を選択した場合は [CTable](../../data/oledb/ctable-class.md) ベースのコンシューマーがウィザードによって作成されます。 テーブルまたはコマンド クラスの名前は、選択したオブジェクトに基づいて決まりますが、この名前は編集できます。

1. **[サポート]** にある **[変更]**、**[挿入]**、および **[削除]** の各チェック ボックスはオフのままにします。

   行セットのレコードの変更、挿入、および削除をサポートするには、**[変更]**、**[挿入]**、および **[削除]** の各チェック ボックスをオンにします。 データ ストアへのデータの書き込みの詳細については、「[行セットの更新](../../data/oledb/updating-rowsets.md)」を参照してください。

1. **[完了]** をクリックしてコンシューマーを作成します。

「[コンシューマー ウィザードで生成されたクラス](../../data/oledb/consumer-wizard-generated-classes.md)」の説明にあるように、ウィザードによってコマンド クラスとユーザー レコード クラスが生成されます。 コマンド クラスは、ウィザードの `Class` ボックスに入力した名前 (`CProducts` など) になり、ユーザー レコード クラスは、"*ClassName*Accessor" 形式の名前 (`CProductsAccessor` など) になります。

> [!NOTE]
> ウィザードによって次の行が `Products.h` に挿入されます。

```cpp
#error Security Issue: The connection string may contain a password
```

> [!NOTE]
> この行により、コンシューマー アプリケーションはコンパイルされず、接続文字列にハード コーディングされたパスワードがないか確認するよう促すメッセージが表示されます。 接続文字列を確認したら、このコード行を削除できます。

::: moniker-end

## <a name="see-also"></a>関連項目

[ウィザードを使用して OLE DB コンシューマーを作成する](../../data/oledb/creating-an-ole-db-consumer-using-a-wizard.md)
