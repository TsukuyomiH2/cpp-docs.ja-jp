---
title: ATL OLE DB コンシューマー ウィザード
ms.date: 07/02/2019
helpviewer_keywords:
- ATL projects, adding ATL OLE DB consumers
ms.assetid: dcb68ed1-2224-422f-9f7b-108a74864204
ms.openlocfilehash: 490335f1f61987fc6e5b0b3806ee8e39c82f336f
ms.sourcegitcommit: 9c2b3df9b837879cd17932ae9f61cdd142078260
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 10/29/2020
ms.locfileid: "92923747"
---
# <a name="atl-ole-db-consumer-wizard"></a>ATL OLE DB コンシューマー ウィザード

::: moniker range="msvc-160"

このウィザードは Visual Studio 2019 以降で使用できません。

::: moniker-end

::: moniker range="<=msvc-150"

このウィザードでは、指定したデータ ソースに、指定した OLE DB プロバイダーを通してアクセスするために必要な OLE DB コンシューマー クラスとデータ バインディングを設定します。

> [!NOTE]
> このウィザードでは、`Class` フィールドと **.h ファイル** フィールドに名前を入力する前に、 **[データ ソース]** ボタンをクリックしてデータ ソースを選択する必要があります。

## <a name="uielement-list"></a>UIElement の一覧

- **データ ソース**

   **[データ ソース]** ボタンによって、指定した OLE DB プロバイダーを使用するデータ ソースを設定できます。 このボタンをクリックすると、 **[データ リンク プロパティ]** ダイアログ ボックスが表示されます。 接続文字列の作成と **[データ リンク プロパティ]** ダイアログ ボックスの詳細については、Windows SDK ドキュメントの「 [Data Link API の概要](/previous-versions/windows/desktop/ms718102(v=vs.85))」を参照してください。

   以下の追加情報では、 **[データ リンク プロパティ]** ダイアログ ボックスのタブについて説明します。

  - **[プロバイダー]** タブ

      データ ソースへの接続を管理するための適切なプロバイダーを選択します。 プロバイダーの種類は、通常、接続先データベースの種類によって決まります。 **[次へ]** ボタンをクリックするか、 **[接続]** タブをクリックします。

  - [ **接続** ] タブ

      このタブの内容は、選択したプロバイダーによって異なります。 プロバイダーには多くの種類がありますが、このセクションでは、最も一般的な2つの SQL データと ODBC データの接続について説明します。 その他は、ここで説明するフィールドに類似するバリエーションです。

      SQL データの場合:

      1. **サーバー名の選択または入力:** ドロップダウンリストメニューをクリックして、ネットワーク上に登録されているすべてのデータサーバーを表示し、1つを選択します。

      1. **サーバーにログオンするための情報を入力してください:** データサーバーにログオンするためのユーザー名とパスワードを入力します。

         > [!NOTE]
         > [データ リンク プロパティ] ダイアログ ボックスの [パスワードを保存する] 機能には、セキュリティ上の問題があります。 [サーバーにログオンするための情報の入力] には、次の 2 つのラジオ ボタンがあります。
         >
         > - **Windows NT 統合セキュリティを使用する**
         > - **[特定のユーザー名とパスワードを使用する]**
         >
         > **[特定のユーザー名とパスワードを使用する]** を選択した場合、パスワードを保存するオプション ([パスワードを保存する] チェック ボックスを使用) がありますが、このオプションは安全ではありません。 **[Windows NT の統合セキュリティを使用する]** を選択することをお勧めします。パスワードが暗号化されるため、このオプションは安全です。
         > [パスワードを保存する] を選択したい状況が発生する場合があります。 たとえば、プライベート データベース ソリューションを使用してライブラリをリリースする場合は、データベースに直接アクセスするのではなく、中間層アプリケーションで (選択した任意の認証スキームを使用して) ユーザーを確認した後、ユーザーが利用できるデータの種類を制限する必要があります。

      1. **サーバー上のデータベースを選択します。** ドロップダウンリストメニューをクリックして、データサーバー上に登録されているすべてのデータベースを表示し、1つを選択します。

         \- または

         データベース **ファイルをデータベース名としてアタッチします。** データベースとして使用するファイルを指定します。明示的なパス名を入力します。

      ODBC データの場合:

      1. **データのソースを指定します。** データソース名または接続文字列を使用できます。

         **データソース名を使用する:** このドロップダウンリストには、コンピューターに登録されているデータソースが表示されます。 事前に、ODBC データ ソース アドミニストレーターを使用してデータ ソースを設定できます。

         \- または

         **接続文字列を使用する:** 既に取得した接続文字列を入力するか、[ **ビルド** ] ボタンをクリックします。 **[データソースの選択** ] ダイアログボックスが表示されます。 ファイルまたはコンピューターのデータ ソースを選択し、 **[OK]** をクリックします。

         > [!NOTE]
         > **サーバー エクスプローラー** で既存の接続のプロパティを表示することで、接続文字列を取得できます。または、 **サーバー エクスプローラー** で **[接続の追加]** をダブルクリックすることで、接続を作成できます。

      1. **サーバーにログオンするための情報を入力してください:** データサーバーにログオンするためのユーザー名とパスワードを入力します。

      1. 使用する初期カタログを入力します。

      1. **[テスト接続]** をクリックしてテストが成功することを確認し、 **[OK]** をクリックします。 そうでない場合は、ログオン情報をチェックするか、別のデータベースで試すか、別のデータ サーバーを試します。

  - **[詳細設定** ] タブ

      **ネットワーク設定:****偽装レベル** (クライアントを偽装するときにサーバーが使用できる偽装のレベル、rpc 偽装レベルに直接対応)、および **保護レベル** (クライアントとサーバー間で送信されるデータの保護レベル) を指定します。これは、rpc 保護レベルに直接対応します。

      **その他:** [ **接続のタイムアウト** ] で、タイムアウトが発生するまでに許容されるアイドル時間の秒数を指定します。 **[アクセス許可]** に、データ接続のアクセス許可を指定します。

      高度な初期化プロパティの詳細については、各 OLE DB プロバイダーで提供されるドキュメントを参照してください。

  - **[すべて]** タブ

      このタブには、指定したデータ ソースと接続の初期化プロパティの概要が表示されます。 これらの値を編集できます。

      [ **OK** ] をクリックして完了します。 **[データベース オブジェクトの選択]** ダイアログ ボックスが表示されます。 このダイアログ ボックスから、コンシューマーが使用するテーブル、ビュー、またはストアド プロシージャを選択します。

- **クラス**

   データ ソースを選択すると、このボックスには、選択したテーブルまたはストアド プロシージャ―に基づいて既定のクラス名が入力されます (後述の「 **データ ソースを選択する** 」を参照してください)。 クラス名を編集できます。

- **.h ファイル**

   データ ソースを選択すると、このボックスには、選択したテーブルまたはストアド プロシージャ―に基づいて既定のヘッダー クラス名が入力されます (後述の「 **データ ソースを選択する** 」を参照してください)。 ヘッダー ファイルの名前を編集したり、既存のヘッダー ファイルを選択したりできます。

- **属性付き**

   このオプションは、ウィザードで属性またはテンプレート宣言のどちらを使用してコンシューマー クラスを作成するかを指定します。 このオプションを選択すると、ウィザードでは、テンプレート宣言 (既定のオプション) ではなく、属性が使用されます。 このオプションを選択解除すると、ウィザードでは、属性ではなくテンプレート宣言が使用されます。

  - コンシューマーの **[種類]** として **[テーブル]** を選択した場合、ウィザードでは、`db_source` 属性と `db_table` 属性を使用してテーブルとテーブル アクセサー クラスの宣言が作成され、`db_column` を使用して列マップが作成されます。 たとえば、次のマップが作成されます。

    ```cpp
    // Inject table class and table accessor class declarations
    [db_source("<initialization_string>"), db_table("dbo.Orders")]
    ...
    // Column map
    [ db_column(1, status=m_dwOrderIDStatus, length=m_dwOrderIDLength) ] LONG m_OrderID;
    [ db_column(2, status=m_dwCustomerIDStatus, length=m_dwCustomerIDLength) ] TCHAR m_CustomerID[6];
    ...
    ```

     次の例では、`CTable` テンプレート クラスを使用してテーブルとテーブル アクセサー クラスを宣言する代わりに、BEGIN_COLUMN_MAP と END_COLUMN_MAP マクロを使用して、列マップを作成しています。

    ```cpp
    // Table accessor class
        class COrdersAccessor; // Table class
        class COrders : public CTable<CAccessor<COrdersAccessor>>;
    // ...
    // Column map
        BEGIN_COLUMN_MAP(COrderDetailsAccessor)
            COLUMN_ENTRY_LENGTH_STATUS(1, m_OrderID, m_dwOrderIDLength, m_dwOrderIDStatus)
            COLUMN_ENTRY_LENGTH_STATUS(2, m_CustomerID, m_dwCustomerIDLength, m_dwCustomerIDStatus)
            // ...
        END_COLUMN_MAP()
    ```

  - コンシューマーの **[種類]** として **[コマンド]** を選択した場合、ウィザードでは、`db_source` 属性と `db_command` 属性が使用され、`db_column` を使用して列マップが作成されます。 たとえば、次のマップが作成されます。

    ```cpp
    [db_source("<initialization_string>"), db_command("SQL_command")]
    ...
    // Column map using db_column is the same as for consumer type of 'table'
    ```

     次の例では、コマンド ライン クラスの .h ファイルのコマンドとコマンド アクセサー クラスの定義が使用されています。

    ```cpp
    // Command accessor class:
        class CListOrdersAccessor;
    // Command class:
        class CListOrders : public CCommand<CAccessor<CListOrdersAccessor>>;
    // ...
    // Column map using BEGIN_COLUMN_MAP ... END_COLUMN_MAP is the same as
    // for consumer type of 'table'
    ```

     詳細については、「 [属性の基本的なしくみ](../../windows/attributes/cpp-attributes-com-net.md#basic-mechanics-of-attributes) 」を参照してください。

- **Type**

   次のボタンのいずれかを選択して、コンシューマー クラスが `CTable` から派生するか `CCommand` (既定値) から派生するかを指定します。

  - **Table**

      `CTable` または `db_table` を使用して、テーブルとテーブル アクセサー クラスの宣言を作成するには、このオプションを選択します。

  - **コマンド**

      `CCommand` または `db_command` を使用して、コマンドとコマンド アクセサー クラスの宣言を作成するには、このオプションを選択します。 これは既定値です。

- **サポート**

   コンシューマーでサポートされる更新の種類を指定するチェック ボックスを選択します (既定値は none です)。 以下のそれぞれによって、[DBPROP_IRowsetChange](/previous-versions/windows/desktop/ms715892(v=vs.85)) と [DBPROP_UPDATABILITY](/previous-versions/windows/desktop/ms722676(v=vs.85)) の適切なエントリがプロパティ セット マップに設定されます。

  - **変更**

      コンシューマーで、行セットの行のデータの更新がサポートされることを指定します。

  - **挿入**

      コンシューマーで、行セットへの行の挿入がサポートされることを指定します。

  - **削除**

      コンシューマーで、行セットからの行の削除がサポートされることを指定します。

::: moniker-end

## <a name="see-also"></a>こちらもご覧ください

[ATL OLE DB コンシューマー](../../atl/reference/adding-an-atl-ole-db-consumer.md)<br/>
[コード ウィザードを使用した機能の追加](../../ide/adding-functionality-with-code-wizards-cpp.md)<br/>
[接続文字列およびデータ リンク (OLE DB)](/previous-versions/windows/desktop/ms718376(v=vs.85))
