---
description: '詳細については、「テクニカルノート 40: MFC/OLE In-Place のサイズ変更とズーム」を参照してください。'
title: 'テクニカルノート 40: MFC-OLE In-Place サイズ変更とズーム'
ms.date: 11/04/2016
helpviewer_keywords:
- resizing in-place
- TN040
- zooming and in-place activation
- in-place activation, zooming and resizing
ms.assetid: 4d7859bd-0b2e-4254-be62-2735cecf02c6
ms.openlocfilehash: e21b70dc10ee467f94386880255287218a3b6e99
ms.sourcegitcommit: d6af41e42699628c3e2e6063ec7b03931a49a098
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 12/11/2020
ms.locfileid: "97215392"
---
# <a name="tn040-mfcole-in-place-resizing-and-zooming"></a>テクニカル ノート 40: MFC/OLE 埋め込み先サイズ変更とズーム

> [!NOTE]
> 次のテクニカル ノートは、最初にオンライン ドキュメントの一部とされてから更新されていません。 結果として、一部のプロシージャおよびトピックが最新でないか、不正になります。 最新の情報について、オンライン ドキュメントのキーワードで関係のあるトピックを検索することをお勧めします。

このメモでは、インプレース編集に関連する問題と、サーバーが適切なズームとインプレースサイズ変更を実行する方法に関する問題について説明します。 埋め込み先のアクティブ化では、WYSIWYG の概念はさらに一歩進んで、コンテナーとサーバーが相互に連携し、特に OLE の仕様はほぼ同じように解釈されます。

インプレースアクティブ化をサポートするコンテナーとサーバーの間の相互作用により、エンドユーザーが管理する必要があるいくつかの予測があります。

- プレゼンテーションの表示 (オーバーライドで描画されたメタファイル) は、 `COleServerItem::OnDraw` 編集のために描画したときとまったく同じように見えます (編集ツールは表示されません)。

- コンテナーをズームすると、サーバーウィンドウも表示されます。

- コンテナーとサーバーの両方で、同じメトリックを使用して編集するためにオブジェクトを表示する必要があります。 これは、ディスプレイデバイスにレンダリングするときの、1インチあたりの *論理* ピクセル数に基づくマッピングモードの使用を意味します。

> [!NOTE]
> インプレースアクティブ化は埋め込まれている (リンクされていない) 項目にのみ適用されるため、ズームは埋め込みオブジェクトにのみ適用されます。 ズームに使用されるとの両方に Api が表示され `COleServerDoc` `COleServerItem` ます。 この dichotomy の理由は、リンクされたアイテムと埋め込みアイテムの両方に対して有効な関数のみ `COleServerItem` (これにより、共通の実装を持つことができます)、および埋め込みオブジェクトに対してのみ有効な関数は、クラスに配置され `COleServerDoc` ます (サーバーの観点からは、埋め込まれた **ドキュメント** です)。

多くの負荷はサーバーの実装に配置されます。そのため、サーバーはコンテナーのズームファクターを認識し、必要に応じて編集インターフェイスを変更する必要があります。 しかし、コンテナーが使用しているズームファクターはサーバーによってどのように決定されますか。

## <a name="mfc-support-for-zooming"></a>MFC によるズームのサポート

現在のズームファクターは、を呼び出すことによって決定でき `COleServerDoc::GetZoomFactor` ます。 ドキュメントが埋め込み先でない場合にこのを呼び出すと、常に100% のズーム率 (または1:1 比) になります。 埋め込み先のアクティブなときに呼び出すと、100% 以外の値が返されることがあります。

ズームの例については、「MFC OLE サンプル [HIERSVR](../overview/visual-cpp-samples.md)」を参照してください。 HIERSVR でのズームは、テキストを表示することによって複雑になります。また、一般に、テキストは線形的な方法ではスケーリングされません (ヒント、表記規則、デザインの幅、および高さのすべてが問題になります)。 ただし、HIERSVR はズームを正しく実装するための妥当な参照であるため、MFC チュートリアルの [SCRIBBLE](../overview/visual-cpp-samples.md) (手順 7) を使用します。

`COleServerDoc::GetZoomFactor` コンテナーまたはクラスの実装から使用できるさまざまなメトリックの数に基づいて、ズーム率を決定 `COleServerItem` し `COleServerDoc` ます。 つまり、現在のズームファクターは次の式によって決定されます。

```
Position Rectangle (PR) / Container Extent (CE)
```

位置の四角形は、コンテナーによって決定されます。 は、が呼び出されたときにサーバーに返され、 `COleClientItem::OnGetItemPosition` コンテナーがを呼び出してサーバーのを呼び出したときに更新され `COleServerDoc::OnSetItemRects` `COleClientItem::SetItemRects` ます。

コンテナーエクステントは、計算が少し複雑になります。 コンテナーが `COleServerItem::OnSetExtent` を呼び出した場合 (を呼び出した場合 `COleClientItem::SetExtent` )、コンテナーエクステントは、この値を、論理インチあたりのピクセル数に基づいてピクセルに変換します。 コンテナーが SetExtent (通常はケース) を呼び出していない場合、コンテナーエクステントはから返されたサイズに `COleServerItem::OnGetExtent` なります。 そのため、コンテナーが SetExtent を呼び出していない場合、フレームワークは、コンテナーが自然なエクステント (から返された値) の100% を使用してそれを呼び出したと見なし `COleServerItem::GetExtent` ます。 別の方法として、フレームワークは、コンテナーが項目の 100% (これ以上ではなく) を表示していることを前提としています。

`COleServerItem::OnSetExtent`と `COleServerItem::OnGetExtent` の名前は似ていますが、項目の同じ属性を操作しないことに注意してください。 `OnSetExtent` は、オブジェクトのどの程度がコンテナーに表示されるか (ズームファクターに関係なく) をサーバーに知らせるために呼び出されます。これは、 `OnGetExtent` オブジェクトの理想的なサイズを決定するためにコンテナーによって呼び出されます。

関連する Api を確認することで、わかりやすい画像を得ることができます。

## <a name="coleserveritemongetextent"></a>COleServerItem:: OnGetExtent

この関数は、項目の HIMETRIC 単位で "自然サイズ" を返す必要があります。 "自然サイズ" を考える最適な方法は、印刷時に表示されるサイズとして定義することです。 ここで返されるサイズは、特定の項目の内容 (特定の項目の定数であるメタファイルとよく似ています) の定数です。 項目にズームが適用されている場合、このサイズは変更されません。 これは通常、コンテナーがを呼び出すことによって項目をより多く、または小さくする場合は変更されません `OnSetExtent` 。 変更の例としては、コンテナーによって送信された最後のエクステントに基づいてテキストをラップする "margin" 機能を持たない単純なテキストエディターが挙げられます。 サーバーが変更された場合は、サーバーでシステムレジストリに OLEMISC_RECOMPOSEONRESIZE ビットを設定することをお勧めします (このオプションの詳細については、OLE SDK のドキュメントを参照してください)。

## <a name="coleserveritemonsetextent"></a>COleServerItem:: OnSetExtent

この関数は、コンテナーがオブジェクトの "より多く" を表示しているときに呼び出されます。 ほとんどのコンテナーはこれを呼び出しません。 既定の実装では、コンテナーから受け取った最後の値が ' m_sizeExtent ' に格納されます。これは、 `COleServerDoc::GetZoomFactor` 上記で説明したコンテナーエクステントの値を計算するときにで使用されます。

## <a name="coleserverdoconsetitemrects"></a>COleServerDoc::OnSetItemRects

この関数は、ドキュメントが埋め込み先でアクティブな場合にのみ呼び出されます。 これは、コンテナーが項目の位置または項目に適用されたクリッピングを更新するときに呼び出されます。 前に説明したように、位置の四角形は、ズームファクターの計算の分子を提供します。 サーバーは、を呼び出すことによって、項目の位置を変更するように要求でき `COleServerDoc::RequestPositionChange` ます。 コンテナーは、(を呼び出すことによって) を呼び出すことによって、この要求に応答しない場合があり `OnSetItemRects` `COleServerItem::SetItemRects` ます。

## <a name="coleserverdocondraw"></a>COleServerDoc:: OnDraw

をオーバーライドすることによって作成されたメタファイルは、 `COleServerItem::OnDraw` 現在のズームファクターに関係なく、まったく同じメタファイルを生成することに注意してください。 コンテナーは、必要に応じてメタファイルをスケーリングします。 これは、ビュー `OnDraw` とサーバー項目の間の重要な違いです `OnDraw` 。 ビューでは、ズームが処理されます。項目は *zoomable* メタファイルを作成し、適切なズームを行うためにコンテナーに移動します。

サーバーが正しく動作することを保証する最善の方法は、 `COleServerDoc::GetZoomFactor` ドキュメントがアクティブな状態である場合にの実装を使用することです。

## <a name="mfc-support-for-in-place-resizing"></a>MFC による In-Place サイズ変更のサポート

MFC では、OLE 2 の仕様で説明されているように、埋め込み先サイズ変更インターフェイスが完全に実装されています。 このユーザーインターフェイスは、 `COleResizeBar` クラス、カスタムメッセージ WM_SIZECHILD、およびでのこのメッセージの特別な処理によってサポートされてい `COleIPFrameWnd` ます。

フレームワークによって提供されるものとは異なる、このメッセージの処理を実装することもできます。 前述のように、フレームワークによってコンテナーに対するインプレースサイズ変更の結果が残ります。サーバーは、ズームファクターの変化に応答します。 コンテナーが、の処理中にコンテナーエクステントと位置四角形の両方を設定することによって反応する場合 `COleClientItem::OnChangeItemPosition` (への呼び出しの結果として呼び出され `COleServerDoc::RequestPositionChange` ます)、埋め込み先のサイズ変更により、編集ウィンドウに項目の "より多く" が表示されます。 の処理中に位置四角形を設定するだけでコンテナーが反応する場合は、 `COleClientItem::OnChangeItemPosition` ズーム率が変化し、項目は "拡大または縮小" されます。

サーバーは、このネゴシエーション中に発生する処理を (ある程度) 制御できます。 たとえば、スプレッドシートでは、ユーザーが項目の編集中にウィンドウのサイズを変更したときに、より多くのセルを表示するように選択できます。 ワードプロセッサは、ウィンドウと同じになるように "ページ余白" を変更し、テキストを新しい余白に折り返します。 サーバーは `COleServerItem::OnGetExtent` 、サイズ変更の完了時に自然なエクステント (から返されたサイズ) を変更することによってこれを実装します。 これにより、位置の四角形とコンテナーの範囲の両方が同じ量だけ変化し、同じズーム率が得られますが、表示領域は拡大または縮小されます。 さらに、によって生成されたメタファイルには、ドキュメントの数が多いか少ないかが表示され `OnDraw` ます。 この場合、ドキュメント自体は、ユーザーが表示領域だけではなく、項目のサイズを変更したときに変更されます。

カスタムサイズ変更を実装しても、 `COleResizeBar` クラス内の WM_SIZECHILD メッセージをオーバーライドすることで、によって提供されるユーザーインターフェイスを引き続き利用できます `COleIPFrameWnd` 。 WM_SIZECHILD の詳細については、「 [テクニカルノート 24](../mfc/tn024-mfc-defined-messages-and-resources.md)」を参照してください。

## <a name="see-also"></a>関連項目

[番号別テクニカルノート](../mfc/technical-notes-by-number.md)<br/>
[カテゴリ別テクニカルノート](../mfc/technical-notes-by-category.md)
