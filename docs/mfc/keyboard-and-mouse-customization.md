---
description: '詳細情報: キーボードとマウスのカスタマイズ'
title: キーボードとマウスのカスタマイズ
ms.date: 11/19/2018
helpviewer_keywords:
- customizations [MFC], keyboard and mouse (MFC Extensions)
- keyboard and mouse customizations (MFC Extensions)
ms.assetid: 1f789f1b-5f2e-4b11-b974-e3e2a2e49d82
ms.openlocfilehash: 2ff54b2092bb6db52d5b780f4e64e51e05d8b402
ms.sourcegitcommit: d6af41e42699628c3e2e6063ec7b03931a49a098
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 12/11/2020
ms.locfileid: "97336826"
---
# <a name="keyboard-and-mouse-customization"></a>キーボードとマウスのカスタマイズ

MFC では、アプリケーションのユーザーがキーボードおよびマウス入力をどのように処理するかをカスタマイズできます。 ユーザーは、コマンドにキーボードショートカットを割り当てることにより、キーボード入力をカスタマイズできます。 ユーザーは、アプリケーションの特定のウィンドウ内でダブルクリックしたときに実行するコマンドを選択して、マウス入力をカスタマイズすることもできます。 このトピックでは、アプリケーションの入力をカスタマイズする方法について説明します。

ユーザーは、[ **カスタマイズ** ] ダイアログボックスでマウスとキーボードのカスタムコントロールを変更できます。 このダイアログボックスを表示するには、ユーザーは [**表示**] メニューの [**カスタマイズ**] をポイントし、[**ツールバーとドッキング**] をクリックします。 ダイアログボックスで、ユーザーは [ **キーボード** ] タブまたは [ **マウス** ] タブのいずれかをクリックします。

## <a name="keyboard-customization"></a>キーボードのカスタマイズ

次の図は、[**カスタマイズ**] ダイアログボックスの [**キーボード**] タブを示しています。

![カスタム ダイアログ ボックスの [キーボード] タブ](../mfc/media/mfcnextkeyboardtab.png "カスタム ダイアログ ボックスの [キーボード] タブ") <br/>
[キーボードのカスタマイズ] タブ

ユーザーは [キーボード] タブを操作して、コマンドに1つ以上のキーボードショートカットを割り当てます。 使用可能なコマンドは、タブの左側に一覧表示されます。ユーザーは、メニューから使用可能な任意のコマンドを選択できます。 メニューコマンドだけをキーボードショートカットに関連付けることができます。 ユーザーが新しいショートカットを入力すると、[ **割り当て** ] ボタンが有効になります。 ユーザーがこのボタンをクリックすると、選択したコマンドがそのショートカットに関連付けられます。

現在割り当てられているすべてのキーボードショートカットは、右側の列のリストボックスに表示されます。 ユーザーは、個々のショートカットを選択して削除したり、アプリケーションのすべてのマッピングをリセットしたりすることもできます。

アプリケーションでこのカスタマイズをサポートする場合は、 [c、](reference/ckeyboardmanager-class.md) オブジェクトを作成する必要があります。 オブジェクトを作成するには `CKeyboardManager` 、関数 [CWinAppEx:: Init# manager](reference/cwinappex-class.md#initkeyboardmanager)を呼び出します。 このメソッドは、キーボードマネージャーを作成して初期化します。 キーボードマネージャーを手動で作成した場合でも、を呼び出し `CWinAppEx::InitKeyboardManager` て初期化する必要があります。

ウィザードを使用してアプリケーションを作成する場合は、ウィザードによってキーボードマネージャーが初期化されます。 アプリケーションによってキーボードマネージャーが初期化されると、[**カスタマイズ**] ダイアログボックスに [**キーボード**] タブが追加されます。

## <a name="mouse-customization"></a>マウスのカスタマイズ

次の図は、[**カスタマイズ**] ダイアログボックスの [**マウス**] タブを示しています。

![カスタム ダイアログ ボックスの [マウス] タブ](../mfc/media/mfcnextmousetab.png "カスタム ダイアログ ボックスの [マウス] タブ") <br/>
マウスの [カスタマイズ] タブ

ユーザーはこのタブと対話して、マウスのダブルクリック操作にメニューコマンドを割り当てます。 ユーザーはウィンドウの左側からビューを選択し、右側にあるコントロールを使用して、コマンドとダブルクリックアクションを関連付けます。 ユーザーが [ **閉じる**] をクリックすると、アプリケーションは、ビュー内の任意の場所をダブルクリックするたびに、関連付けられているコマンドを実行します。

既定では、ウィザードを使用してアプリケーションを作成するときに、マウスのカスタマイズは無効になっています。

#### <a name="to-enable-mouse-customization"></a>マウスのカスタマイズを有効にするには

1. [CWinAppEx:: InitMouseManager](reference/cwinappex-class.md#initmousemanager)を呼び出して[cmousemanager](reference/cmousemanager-class.md)オブジェクトを初期化します。

1. [CWinAppEx:: GetMouseManager](reference/cwinappex-class.md#getmousemanager)を使用して、マウスマネージャーへのポインターを取得します。

1. [Cmousemanager:: AddView](reference/cmousemanager-class.md#addview)メソッドを使用して、ビューをマウスマネージャーに追加します。 この操作は、マウスマネージャーに追加するすべてのビューに対して行います。

アプリケーションによってマウスマネージャーが初期化されると、フレームワークによって [**ユーザー設定**] ダイアログボックスに **マウス** タブが追加されます。 ビューを追加しないと、タブにアクセスしても、ハンドルされない例外が発生します。 ビューの一覧を作成すると、ユーザーが **マウス** のタブを使用できるようになります。

新しいビューをマウスマネージャーに追加する場合は、一意の ID を指定します。 ウィンドウのマウスのカスタマイズをサポートする場合は、WM_LBUTTONDBLCLICK メッセージを処理し、 [CWinAppEx:: OnViewDoubleClick](reference/cwinappex-class.md#onviewdoubleclick) 関数を呼び出す必要があります。 この関数を呼び出すと、パラメーターの1つがそのウィンドウの ID になります。 ID 番号とそれに関連付けられているオブジェクトを追跡するのは、プログラマの責任です。

## <a name="security-concerns"></a>セキュリティに関する注意事項

「 [ユーザー定義ツール](user-defined-tools.md)」で説明されているように、ユーザーは、ユーザー定義ツール ID をダブルクリックイベントに関連付けることができます。 ユーザーがビューをダブルクリックすると、アプリケーションは、関連付けられている ID と一致するユーザーツールを探します。 一致するツールが見つかった場合は、ツールを実行します。 アプリケーションが一致するツールを見つけられない場合は、ダブルクリックされたビューに ID を持つ WM_COMMAND メッセージを送信します。

カスタマイズした設定はレジストリに格納されます。 レジストリを編集することにより、攻撃者は、有効なユーザーツール ID を任意のコマンドに置き換えることができます。 ユーザーがビューをダブルクリックすると、攻撃者が植えるしたコマンドがビューによって処理されます。 これにより、予期しない危険性のある動作が発生する可能性があります。

さらに、この種の攻撃では、ユーザーインターフェイスの保護をバイパスできます。 たとえば、アプリケーションで印刷が無効になっているとします。 つまり、ユーザーインターフェイスでは、[ **印刷** ] メニューとボタンは使用できません。 通常、これにより、アプリケーションは印刷できなくなります。 しかし、攻撃者がレジストリを編集した場合、ユーザーは表示をダブルクリックして印刷コマンドを直接送信できるようになり、使用できないユーザーインターフェイス要素がバイパスされる可能性があります。

この種の攻撃から保護するには、アプリケーションコマンドハンドラーにコードを追加して、コマンドが実行前に有効であることを確認します。 コマンドがアプリケーションに送信されないようにするために、ユーザーインターフェイスに依存しないでください。

## <a name="see-also"></a>関連項目

[MFC のカスタマイズ](customization-for-mfc.md)<br/>
[Cのマネージャークラス](reference/ckeyboardmanager-class.md)<br/>
[CMouseManager クラス](reference/cmousemanager-class.md)<br/>
[カスタマイズによるセキュリティへの影響](security-implications-of-customization.md)
