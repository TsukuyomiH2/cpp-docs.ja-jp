---
title: 登録
ms.date: 11/04/2016
helpviewer_keywords:
- servers [MFC], initializing
- initializing servers [MFC]
- OLE, registration
- installing servers [MFC]
- registry [MFC], OLE item database
- registration databases [MFC]
- servers [MFC], installing
- OLE server applications [MFC], registering servers
ms.assetid: 991d5684-72c1-4f9e-a09a-9184ed12bbb9
ms.openlocfilehash: 82411e53620e92eff3484f7d3f7955030fd439ac
ms.sourcegitcommit: c123cc76bb2b6c5cde6f4c425ece420ac733bf70
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/14/2020
ms.locfileid: "81372842"
---
# <a name="registration"></a>登録

OLE アイテムをアプリケーションに挿入する場合、OLE は選択するオブジェクトの種類の一覧を表示します。 OLE は、システム登録データベースからこのリストを取得します。 サーバーが自分自身を登録するとき、システム登録データベース (レジストリ) に入れるエントリは、提供するオブジェクトの各タイプ、ファイル拡張子、およびそれ自体へのパスなどを記述します。

フレームワークと OLE システム ダイナミック リンク ライブラリ (DLL) は、このレジストリを使用して、システムで使用できる OLE アイテムの種類を決定します。 OLE システム DLL は、リンク オブジェクトまたは埋め込みオブジェクトがアクティブになったときにサーバー アプリケーションを起動する方法を決定するために、このレジストリを使用します。

この資料では、各サーバー アプリケーションがインストールされたときと実行されるごとに、各サーバー アプリケーションが実行する必要がある処理について説明します。

システム登録データベースの詳細と、更新に使用される .reg ファイルの形式については、 OLE*プログラマ リファレンス を参照してください*。

## <a name="server-installation"></a><a name="_core_server_installation"></a>サーバーのインストール

サーバー アプリケーションを初めてインストールするときに、サポートするすべての OLE アイテムを登録する必要があります。 スタンドアロン アプリケーションとして実行するたびに、サーバーにシステム登録データベースを更新させることができます。 これにより、サーバーの実行可能ファイルが移動された場合に、登録データベースが最新の状態に保ちます。

> [!NOTE]
> アプリケーション ウィザードによって生成された MFC アプリケーションは、スタンドアロン アプリケーションとして実行されると自動的に登録されます。

インストール中にアプリケーションを登録する場合は、RegEdit.exe プログラムを使用します。 アプリケーションにセットアップ プログラムを含める場合は、セットアップ プログラムで "RegEdit /S*アプリ名*.reg" を実行します。 (/S フラグは、サイレント操作を示します。それ以外の場合は、RegEdit を手動で実行するようにユーザーに指示します。

> [!NOTE]
> アプリケーション ウィザードで作成された .reg ファイルには、実行可能ファイルの完全なパスが含まれていません。 インストール プログラムは、実行可能ファイルへの完全なパスを含むように .reg ファイルを変更するか、またはインストール ディレクトリを含むように PATH 環境変数を変更する必要があります。

RegEdit は、.reg テキスト ファイルの内容を登録データベースにマージします。 データベースを確認したり、修復したりするには、レジストリ エディタを使用します。 必須の OLE エントリは削除しないように注意してください。

## <a name="server-initialization"></a><a name="_core_server_initialization"></a>サーバーの初期化

アプリケーション・ウィザードを使用してサーバー・アプリケーションを作成すると、ウィザードによってすべての初期化タスクが自動的に完了します。 このセクションでは、サーバー アプリケーションを手動で作成する場合に実行する必要がある操作について説明します。

コンテナー アプリケーションによってサーバー アプリケーションが起動されると、OLE システム DLL はサーバーのコマンド ラインに "/Embedding" オプションを追加します。 サーバー アプリケーションの動作は、コンテナーによって起動されたかどうかによって異なるので、実行を開始するときにアプリケーションが最初に行うべきことは、コマンド ラインの "/Embedding" または "-Embedding" オプションを確認することです。 このスイッチが存在する場合は、サーバーがインプレース アクティブまたは完全に開いている状態であることを示す別のリソース セットを読み込みます。 詳細については、「[メニューとリソース: サーバーの追加](../mfc/menus-and-resources-server-additions.md)」を参照してください。

サーバー アプリケーションは、コマンド`CWinApp::RunEmbedded`ラインを解析するために関数も呼び出す必要があります。 0 以外の値を返す場合、アプリケーションはスタンドアロン アプリケーションとしてではなく、コンテナー アプリケーションから実行されているため、ウィンドウを表示しないようにします。 この関数は、システム登録データベース内のサーバーのエントリを更新し、`RegisterAll`インスタンス登録を実行してメンバー関数を呼び出します。

サーバー アプリケーションが起動したら、インスタンス登録を実行できることを確認する必要があります。 インスタンス登録は、サーバーがアクティブであり、コンテナーからの要求を受信する準備ができたことを OLE システム DLL に通知します。 登録データベースにエントリを追加しません。 で定義されたメンバー関数を呼び出`ConnectTemplate`して、サーバーの`COleTemplateServer`インスタンス登録を実行します。 これにより、オブジェクト`CDocTemplate`がオブジェクトに`COleTemplateServer`接続されます。

この`ConnectTemplate`関数は、サーバーの*CLSID*、`CDocTemplate`オブジェクトへのポインター、およびサーバーが複数のインスタンスをサポートしているかどうかを示すフラグの 3 つのパラメーターを受け取ります。 ミニサーバーは、複数のインスタンスをサポートできる必要があります。 したがって、ミニサーバーを起動するときに、このフラグに**TRUE**を渡します。

ミニサーバーを作成する場合、定義上、それは常にコンテナーによって起動されます。 コマンド ラインを解析して、"/Embedding" オプションを確認する必要があります。 コマンド ラインにこのオプションが存在しない場合、ユーザーはミニサーバーをスタンドアロン アプリケーションとして起動しようとしました。 この場合は、システム登録データベースにサーバーを登録し、コンテナー アプリケーションからミニサーバーを起動するようにユーザーに通知するメッセージ ボックスを表示します。

## <a name="see-also"></a>関連項目

[OLE●ole○](../mfc/ole-in-mfc.md)<br/>
[サーバー](../mfc/servers.md)<br/>
[CWinApp::自動実行](../mfc/reference/cwinapp-class.md#runautomated)<br/>
[CWinApp::埋め込まれた実行](../mfc/reference/cwinapp-class.md#runembedded)<br/>
[COleTemplateServer クラス](../mfc/reference/coletemplateserver-class.md)
