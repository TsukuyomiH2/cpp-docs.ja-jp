---
title: 印刷プレビューのアーキテクチャ
ms.date: 11/04/2016
helpviewer_keywords:
- print preview [MFC], process
- previewing printing
- print preview [MFC], architecture
- printing [MFC], print preview
- print preview [MFC], modifications to MFC
ms.assetid: 0efc87e6-ff8d-43c5-9d72-9b729a169115
ms.openlocfilehash: 5943edc22cd48ed10d152f72624467ff87104b96
ms.sourcegitcommit: c123cc76bb2b6c5cde6f4c425ece420ac733bf70
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/14/2020
ms.locfileid: "81375946"
---
# <a name="print-preview-architecture"></a>印刷プレビューのアーキテクチャ

この資料では、MFC フレームワークが印刷プレビュー機能を実装する方法について説明します。 取り上げるトピックは次のとおりです。

- [印刷プレビュープロセス](#_core_the_print_preview_process)

- [印刷プレビューの変更](#_core_modifying_print_preview)

印刷プレビューは、デバイスに直接イメージを描画するのではなく、画面を使用してプリンタをシミュレートする必要があるため、画面表示や印刷とは多少異なります。 これに対応するために、Microsoft Foundation クラス ライブラリは[、 CDC Class](../mfc/reference/cdc-class.md)から派生した特別`CPreviewDC`な (文書化されていない) クラスを定義します。 すべての`CDC`オブジェクトには 2 つのデバイス コンテキストが含まれますが、通常は同じです。 オブジェクトでは`CPreviewDC`、それらは異なっています:最初はシミュレートされているプリンタを表し、2番目のは出力が実際に表示される画面を表します。

## <a name="the-print-preview-process"></a><a name="_core_the_print_preview_process"></a>印刷プレビュープロセス

ユーザーが **[ファイル]** メニューから [印刷プレビュー] コマンドを選択`CPreviewDC`すると、フレームワークによってオブジェクトが作成されます。 アプリケーションがプリンターデバイスコンテキストの特性を設定する操作を実行するたびに、フレームワークは、画面デバイスコンテキストで同様の操作も実行します。 たとえば、アプリケーションで印刷用のフォントを選択した場合、フレームワークは、プリンター フォントをシミュレートする画面表示用のフォントを選択します。 アプリケーションがプリンターに出力を送信する場合は、フレームワークが出力を画面に送信します。

印刷プレビューは、各ページが文書のページを描画する順序で印刷する場合とは異なります。 印刷中、フレームワークは、特定の範囲のページがレンダリングされるまで、印刷ループを続行します。 印刷プレビュー中は、1 ページまたは 2 ページがいつでも表示され、アプリケーションは待機します。ユーザーが応答するまで、それ以上のページは表示されません。 印刷プレビュー中は、通常の画面表示時と同様に、WM_PAINTメッセージにも応答する必要があります。

[CView::OnPreparePrinting](../mfc/reference/cview-class.md#onprepareprinting)関数は、印刷ジョブの開始時と同様に、プレビュー モードが呼び出されたときに呼び出されます。 関数に渡される[CPrintInfo 構造体](../mfc/reference/cprintinfo-structure.md)構造体には、印刷プレビュー操作の特定の特性を調整するために設定できる値を持つ複数のメンバーが含まれています。 たとえば *、m_nNumPreviewPages*メンバーを設定して、ドキュメントを 1 ページモードでプレビューするか、2 ページモードでプレビューするかを指定できます。

## <a name="modifying-print-preview"></a><a name="_core_modifying_print_preview"></a>印刷プレビューの変更

印刷プレビューの動作や外観は、さまざまな方法で簡単に変更できます。 たとえば、次のことが可能です。

- 印刷プレビュー ウィンドウにスクロール バーを表示させ、ドキュメントの任意のページに簡単にアクセスします。

- 印刷プレビューを行うと、現在のページで表示を開始することによって、ドキュメント内でのユーザーの位置が維持されます。

- 印刷プレビューと印刷で異なる初期化を実行します。

- 印刷プレビューでページ番号を独自の形式で表示します。

ドキュメントの長さを把握し、適切な値`SetMaxPage`を指定して呼び出す場合、フレームワークは、この情報を印刷時だけでなくプレビュー モードでも使用できます。 フレームワークはドキュメントの長さを認識すると、プレビュー ウィンドウにスクロール バーを表示し、ユーザーがドキュメントをプレビュー モードで前後にページ移動できるようにします。 ドキュメントの長さを設定していない場合、フレームワークは現在の位置を示すスクロール ボックスを配置できないため、フレームワークはスクロール バーを追加しません。 この場合、ユーザーはプレビュー ウィンドウのコントロール バーにある [次のページ] ボタンと [前のページ] ボタンを使用してドキュメントをページ表示する必要があります。

印刷プレビューでは、通常の印刷では決して行わない場合でも`CPrintInfo`、 の*m_nCurPage*メンバに値を割り当てると便利です。 通常の印刷では、このメンバーはフレームワークからビュー クラスに情報を提供します。 これは、フレームワークがどのページを印刷するかをビューに通知する方法です。

対照的に、印刷プレビュー モードが開始されると *、m_nCurPage*メンバーは、ビューからフレームワークに向けて、反対方向の情報を運びます。 フレームワークは、このメンバーの値を使用して、最初にプレビューするページを決定します。 このメンバーのデフォルト値は 1 なので、ドキュメントの最初のページが最初に表示されます。 このメンバーを`OnPreparePrinting`、印刷プレビュー コマンドが呼び出された時点で表示されていたページの番号に設定するようにオーバーライドできます。 このようにして、アプリケーションは、通常の表示モードから印刷プレビュー モードに移行するときに、ユーザーの現在の位置を維持します。

印刷ジョブまたは印刷`OnPreparePrinting`プレビューのどちらを呼び出すかによって、初期化を異なる場合があります。 構造体の*m_bPreview*メンバー変数を調べることで`CPrintInfo`、これを確認できます。 印刷プレビューが呼び出されると、このメンバーは**TRUE**に設定されます。

この`CPrintInfo`構造体には、 *m_strPageDesc*という名前のメンバーも含まれており、このメンバーは、画面の下部に表示される文字列を単一ページモードおよび複数ページモードで書式設定するために使用されます。 既定では、これらの文字列は "Page *n"* と "Page *n* - *m"* の形式`OnPreparePrinting`ですが、内部から*m_strPageDesc*を変更し、より詳細な文字列に設定できます。 詳細については *、MFC リファレンス*の[「CPrintInfo 構造体](../mfc/reference/cprintinfo-structure.md)」を参照してください。

## <a name="see-also"></a>関連項目

[[印刷と印刷プレビュー]](../mfc/printing-and-print-preview.md)<br/>
[印刷](../mfc/printing.md)<br/>
[Cビュークラス](../mfc/reference/cview-class.md)<br/>
[CDCクラス](../mfc/reference/cdc-class.md)
