---
title: 印刷プレビューのアーキテクチャ
ms.date: 11/04/2016
helpviewer_keywords:
- print preview [MFC], process
- previewing printing
- print preview [MFC], architecture
- printing [MFC], print preview
- print preview [MFC], modifications to MFC
ms.assetid: 0efc87e6-ff8d-43c5-9d72-9b729a169115
ms.openlocfilehash: 1956313d4e904255ba59e79690fe3d7144669a29
ms.sourcegitcommit: c21b05042debc97d14875e019ee9d698691ffc0b
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 06/09/2020
ms.locfileid: "84623936"
---
# <a name="print-preview-architecture"></a>印刷プレビューのアーキテクチャ

この記事では、MFC フレームワークで印刷プレビュー機能を実装する方法について説明します。 取り上げるトピックは次のとおりです。

- [印刷プレビュープロセス](#_core_the_print_preview_process)

- [印刷プレビューの変更](#_core_modifying_print_preview)

印刷プレビューは、デバイス上にイメージを直接描画するのではなく、画面を使用してプリンターをシミュレートする必要があるため、画面の表示と印刷とは多少異なります。 これに対応するために、Microsoft Foundation Class ライブラリは、という名前の[CDC クラス](reference/cdc-class.md)から派生した特殊な (ドキュメント化されていない) クラスを定義し `CPreviewDC` ます。 すべて `CDC` のオブジェクトに2つのデバイスコンテキストが含まれていますが、通常は同じです。 オブジェクトで `CPreviewDC` は、これらは異なります。1つ目はシミュレートされるプリンターを表し、2つ目は出力が実際に表示される画面を表します。

## <a name="the-print-preview-process"></a><a name="_core_the_print_preview_process"></a>印刷プレビュープロセス

ユーザーが [**ファイル**] メニューから [印刷プレビュー] コマンドを選択すると、フレームワークによってオブジェクトが作成さ `CPreviewDC` れます。 アプリケーションがプリンターデバイスコンテキストの特性を設定する操作を実行するたびに、フレームワークは画面デバイスコンテキストに対して同様の操作を実行します。 たとえば、アプリケーションが印刷用のフォントを選択した場合、フレームワークは、プリンターのフォントをシミュレートする画面表示のフォントを選択します。 アプリケーションがプリンターに出力を送信するたびに、フレームワークは画面に出力を送信します。

印刷プレビューも、それぞれがドキュメントのページを描画する順序で印刷する場合とは異なります。 印刷中は、特定の範囲のページがレンダリングされるまで、フレームワークは印刷ループを続行します。 印刷プレビュー中は、1ページまたは2ページがいつでも表示され、アプリケーションは待機します。ユーザーが応答するまで、それ以上のページは表示されません。 印刷プレビュー中に、アプリケーションは通常の画面表示と同様に WM_PAINT メッセージにも応答する必要があります。

[CView:: OnPreparePrinting](reference/cview-class.md#onprepareprinting)関数は、印刷ジョブの開始時と同様に、プレビューモードが呼び出されたときに呼び出されます。 関数に渡される[CPrintInfo structure](reference/cprintinfo-structure.md)構造体には、印刷プレビュー操作の特定の特性を調整するために設定できる値を持つメンバーがいくつか含まれています。 たとえば、 *m_nNumPreviewPages*メンバーを設定して、ドキュメントを1ページモードと2ページモードのどちらでプレビューするかを指定できます。

## <a name="modifying-print-preview"></a><a name="_core_modifying_print_preview"></a>印刷プレビューの変更

印刷プレビューの動作と外観は、さまざまな方法で簡単に変更できます。 たとえば、次のようなものがあります。

- [印刷プレビュー] ウィンドウにスクロールバーが表示され、ドキュメントの任意のページに簡単にアクセスできるようになります。

- 現在のページでの表示を開始して、ドキュメント内のユーザーの位置を維持するには、印刷プレビューが発生します。

- 印刷のプレビューと印刷に対して異なる初期化が実行されます。

- 印刷プレビューによって、ページ番号が独自の形式で表示されるようにします。

ドキュメントがであり、適切な値を使用してを呼び出すことがわかっている場合 `SetMaxPage` 、フレームワークは、印刷時だけでなく、この情報をプレビューモードでも使用できます。 フレームワークがドキュメントの長さを認識すると、プレビューウィンドウにスクロールバーが表示されるため、ユーザーはプレビューモードでドキュメントを前後に移動できます。 ドキュメントの長さを設定していない場合、フレームワークはスクロールボックスを配置して現在の位置を示すことができないため、フレームワークはスクロールバーを追加しません。 この場合、ユーザーはプレビューウィンドウのコントロールバーの [次のページ] ボタンと [前のページ] ボタンを使用してドキュメントを表示する必要があります。

印刷プレビューでは、通常の印刷では実行しない場合でも、の*m_nCurPage*メンバーに値を割り当てると便利な場合があり `CPrintInfo` ます。 通常の印刷時には、このメンバーがフレームワークからビュークラスに情報を伝達します。 ここでは、どのページを印刷するかを表示するようフレームワークに指示します。

これに対し、印刷プレビューモードを開始すると、 *m_nCurPage*メンバーは、ビューからフレームワークへの逆方向の情報を伝達します。 フレームワークは、このメンバーの値を使用して、最初にプレビューするページを決定します。 このメンバーの既定値は1であるため、ドキュメントの最初のページが最初に表示されます。 をオーバーライドして、 `OnPreparePrinting` 印刷プレビューコマンドが呼び出されたときに表示されるページの数にこのメンバーを設定できます。 これにより、アプリケーションは通常の表示モードから印刷プレビューモードに移行するときに、ユーザーの現在の位置を維持します。

場合に `OnPreparePrinting` よっては、印刷ジョブまたは印刷プレビューに対して呼び出されるかどうかに応じて、さまざまな初期化を実行します。 これを確認するには、構造体の*m_bPreview*メンバー変数を調べ `CPrintInfo` ます。 このメンバーは、印刷プレビューが呼び出されたときに**TRUE**に設定されます。

`CPrintInfo`構造体には、 *m_strPageDesc*という名前のメンバーも含まれています。これは、シングルページモードと複数ページモードで画面の下部に表示される文字列を書式設定するために使用されます。 既定では、これらの文字列は "ページ*n*" と "ページ*n*m" の形式になり  -  *m*ますが、内から*m_strPageDesc*を変更 `OnPreparePrinting` して、文字列をより複雑なものに設定することができます。 詳細については、 *MFC リファレンス*の「 [CPrintInfo 構造体](reference/cprintinfo-structure.md)」を参照してください。

## <a name="see-also"></a>関連項目

[[印刷と印刷プレビュー]](printing-and-print-preview.md)<br/>
[印刷](printing.md)<br/>
[CView クラス](reference/cview-class.md)<br/>
[CDC クラス](reference/cdc-class.md)
