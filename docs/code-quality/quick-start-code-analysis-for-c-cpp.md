---
title: 'クイックスタート: C/C++ のコード分析'
description: Visual Studio の C++ コードで静的分析を実行し、一般的なコーディングの問題や問題を検出します。
ms.date: 04/08/2020
ms.topic: conceptual
helpviewer_keywords:
- C/C++ code analysis
- code analysis, C/C++
ms.openlocfilehash: 43866564915ac84d227ccbf347280efe59e33351
ms.sourcegitcommit: c123cc76bb2b6c5cde6f4c425ece420ac733bf70
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/14/2020
ms.locfileid: "81370579"
---
# <a name="quickstart-code-analysis-for-cc"></a>クイックスタート: C/C++ のコード分析

C または C++ コードのコード分析を定期的に実行することで、アプリケーションの品質を向上できます。 コード分析は、一般的な問題や優れたプログラミング手法の違反を見つけるのに役立ちます。 そして、テストを通して発見するのが難しい欠陥を見つけます。 警告はコンパイラのエラーや警告とは異なります: 問題の原因と認識されている特定のコード パターンを検索します。 つまり、コードは有効ですが、自分またはコードを使用する他のユーザーに対して問題が発生する可能性があります。

## <a name="configure-rule-sets-for-a-project"></a>プロジェクトの規則セットの構成

1. **ソリューション エクスプローラ**で、プロジェクト名のショートカット メニューを開き、[**プロパティ]** をクリックします。

1. 必要に応じて、[**構成**] および [**プラットフォーム**] の一覧で、ビルド構成とターゲット プラットフォームを選択します。

1. 選択した構成を使用してプロジェクトをビルドするたびにコード分析を実行するには、[**ビルド時にコード分析を有効にする**] チェック ボックスをオンにします。 [**分析**] メニューを開き、[*プロジェクト名***に対してコード分析を実行**] または [ファイルにコード分析を実行] を選択して、コード**分析を手動で実行**することもできます。

1. 使用する[ルール セット](using-rule-sets-to-specify-the-cpp-rules-to-run.md)を選択するか、[カスタム ルール セット](using-rule-sets-to-specify-the-cpp-rules-to-run.md#to-create-a-rule-set-in-a-text-editor)を作成します。 LLVM/clang-cl を使用する場合は[、「Visual Studio で Clang-Tidy を使用して Clang-Tidy](../code-quality/clang-tidy.md)分析オプションを構成する」を参照してください。

### <a name="standard-cc-rule-sets"></a>標準 C/C++ ルール セット

Visual Studio には、ネイティブ コードに関する次の標準規則セットが含まれています。

| ルール セット | 説明 |
|--|--|
| **C++ コア チェック算術規則** | これらの規則は[、C++ コア ガイドライン の算術演算に](https://github.com/isocpp/CppCoreGuidelines/blob/master/CppCoreGuidelines.md#es-expressions-and-statements)関連するチェックを適用します。 |
| **C++ コア チェック境界規則** | これらの規則は[、C++ コア ガイドライン の境界プロファイルを適用します](https://github.com/isocpp/CppCoreGuidelines/blob/master/CppCoreGuidelines.md#probounds-bounds-safety-profile)。 |
| **C++ コア チェック クラス規則** | これらの規則は[、C++ コア ガイドライン のクラス](https://github.com/isocpp/CppCoreGuidelines/blob/master/CppCoreGuidelines.md#c-classes-and-class-hierarchies)に関連するチェックを適用します。 |
| **C++ コア チェック同時実行ルール** | これらの規則では[、C++ コア ガイドライン からの同時実行に関連するチェックが適用されます](https://github.com/isocpp/CppCoreGuidelines/blob/master/CppCoreGuidelines.md#cpcon-concurrency)。 |
| **C++ コア チェック コンスト ルール** | これらの規則は[、C++ コア ガイドライン から const 関連のチェックを適用します](https://github.com/isocpp/CppCoreGuidelines/blob/master/CppCoreGuidelines.md#con-constants-and-immutability)。 |
| **C++ コア チェック宣言規則** | これらの規則は[、C++ コア ガイドライン からの宣言](https://github.com/isocpp/CppCoreGuidelines/blob/master/CppCoreGuidelines.md#i-interfaces)に関連するチェックを適用します。 |
| **C++ コア チェック列挙規則** | これらの規則は[、C++ コア ガイドライン からの列挙関連のチェックを](https://github.com/isocpp/CppCoreGuidelines/blob/master/CppCoreGuidelines.md#S-enum)適用します。 |
| **C++ コア チェック実験規則** | これらのルールは、いくつかの実験的なチェックを収集します。 最終的には、これらのチェックは他のルールセットに移動されるか、完全に削除される予定です。 |
| **C++ コア チェック関数の規則** | これらの規則は[、C++ コア ガイドライン の関数](https://github.com/isocpp/CppCoreGuidelines/blob/master/CppCoreGuidelines.md#f-functions)に関連するチェックを適用します。 |
| **C++ コア チェック GSL ルール** | これらの規則では[、C++ コア ガイドライン のガイドライン サポート ライブラリに関連するチェックが適用されます](https://github.com/isocpp/CppCoreGuidelines/blob/master/CppCoreGuidelines.md#S-gsl)。 |
| **C++ コア チェックの有効期間ルール** | これらの規則は[、C++ コア ガイドライン の有効期間プロファイルを](https://github.com/isocpp/CppCoreGuidelines/blob/master/CppCoreGuidelines.md#prolifetime-lifetime-safety-profile)適用します。 |
| **C++ コア チェック所有者ポインター 規則** | これらの規則は[、C++ コア ガイドライン&lt;&gt;の所有者 T](https://github.com/isocpp/CppCoreGuidelines/blob/master/CppCoreGuidelines.md#r-resource-management)に関連するリソース管理チェックを強制します。 |
| **C++ コア チェック生ポインター ルール** | これらの規則は[、C++ コア ガイドライン の生のポインター](https://github.com/isocpp/CppCoreGuidelines/blob/master/CppCoreGuidelines.md#r-resource-management)に関連するリソース管理チェックを強制します。 |
| **C++ コア チェック ルール** | これらの規則は[、C++ コア ガイドライン](https://github.com/isocpp/CppCoreGuidelines/blob/master/CppCoreGuidelines.md#c-core-guidelines)からのチェックのサブセットを適用します。 このルールセットを使用して、列挙ルールセットと実験ルールセットを除くすべての C++ コアチェックルールを含めます。 |
| **C++ コア チェック共有ポインター ルール** | これらの規則は[、C++ コア ガイドライン の共有ポインター セマンティクスを持つ型](https://github.com/isocpp/CppCoreGuidelines/blob/master/CppCoreGuidelines.md#r-resource-management)に関連するリソース管理チェックを実施します。 |
| **C++ コア チェック STL ルール** | これらの規則は[、C++ のコア ガイドライン から C++ 標準テンプレート ライブラリ (STL) に](https://github.com/isocpp/CppCoreGuidelines/blob/master/CppCoreGuidelines.md#S-stdlib)関連するチェックを適用します。 |
| **C++ コア チェック スタイル ルール** | これらの規則は[、C++ コア ガイドライン の式およびステートメントの使用に](https://github.com/isocpp/CppCoreGuidelines/blob/master/CppCoreGuidelines.md#es-expressions-and-statements)関連するチェックを適用します。 |
| **C++ コア チェックの種類の規則** | これらの規則は[、C++ コア ガイドライン の型プロファイルを適用します](https://github.com/isocpp/CppCoreGuidelines/blob/master/CppCoreGuidelines.md#prosafety-type-safety-profile)。 |
| **C++ コア チェック一意のポインター規則** | これらの規則は[、C++ コア ガイドライン の一意のポインター セマンティクス](https://github.com/isocpp/CppCoreGuidelines/blob/master/CppCoreGuidelines.md#r-resource-management)を持つ型に関連するリソース管理チェックを実施します。 |
| **同時実行チェックルール** | これらの規則は、C++ での Win32 同時実行パターン チェックのセットを強制します。 |
| **同時実行ルール** | C++ コア ガイドラインから同時実行チェック ルール に**同時実行ルールを**追加します。 |
| **マイクロソフトネイティブの最小ルール** | これらのルールは、潜在的なセキュリティ ホールやアプリケーションのクラッシュなど、ネイティブ コードの最も重大な問題に焦点を当てています。 このルール セットは、ネイティブ プロジェクト用に作成するカスタム規則セットに含めるをお勧めします。 |
| **Microsoft ネイティブ推奨規則** | これらの規則は、ネイティブ コードで最も重大な問題と一般的な問題に焦点を当てています。 これらの問題には、潜在的なセキュリティ ホールやアプリケーションのクラッシュが含まれます。 このルール セットは、ネイティブ プロジェクト用に作成するカスタム規則セットに含めるをお勧めします。 この規則セットは、Visual Studio Professional Edition 以上で動作するように設計されています。 このファイルには、 **Microsoft ネイティブの最小規則 のすべての規則が**含まれています。 |

Visual Studio には、マネージ コードに関する次の標準規則セットが含まれています。

| ルール セット | 説明 |
|--|--|
| **マイクロソフトの基本的な正確性の規則** | これらの規則は、フレームワーク API の使用の際の論理エラー、およびよくある失敗に関するものです。 この規則セットは、最小推奨規則で報告された警告の一覧から、さらに詳しい情報へと掘り下げる必要がある場合に使用してください。 |
| **マイクロソフトの基本的な設計ガイドラインの規則** | これらの規則は、コードをわかりやすく、また使いやすくするためのベスト プラクティスに関するものです。 この規則セットは、プロジェクトにライブラリ コードが含まれる場合や、コードをメンテナンスしやすくするためにべスト プラクティスを適用する場合に使用してください。 |
| **マイクロソフト拡張正しさルール** | これらのルールは、報告されたロジックとフレームワークの使用エラーを最大化するために、基本的な正確性ルールに拡張されます。 COM 相互運用機能やモバイル アプリケーションなど、特定のシナリオに重点が置かれています。 これらのシナリオのいずれかに該当するプロジェクトがある場合や、プロジェクト内の問題をさらに細かく探す必要がある場合には、この規則セットの使用を検討してください。 |
| **マイクロソフト拡張デザイン ガイドラインルール** | これらのルールは、報告されたユーザビリティと保守性の問題を最大化するために、基本的な設計ガイドラインルールに拡張されます。 特に、命名に関するガイドラインに重点が置かれています。 プロジェクトにライブラリ コードが含まれる場合や、コード記述の方法に最高レベルの基準を適用してメンテナンスを容易にするには、この規則セットの使用を検討してください。 |
| **マイクロソフトグローバリゼーションルール** | これらの規則は、複数の言語、ロケール、およびカルチャが使用される環境において、データの正しい表示を妨げる問題に対処する規則です。 アプリケーションがローカライズまたはグローバル化されている場合は、このルール セットを含めます。 |
| **マイクロソフト管理の最小ルール** | これらの規則は、コード分析が最も厳密に行われる、コードの最も重大な問題に関するものです。  規則は少数で、限られた Visual Studio エディションだけで使用されることが意図されています。  他の Visual Studio エディションでは、MinimumRecommendedRules.ruleset を使用してください。 |
| **マイクロソフト管理の推奨ルール** | これらのルールは、コード内で最も重大な問題に焦点を当てています。 これらの問題には、潜在的なセキュリティ ホール、アプリケーションのクラッシュ、その他の重要なロジックと設計エラーが含まれます。 このルール セットは、プロジェクト用に作成するカスタムルールセットに含めるのをお勧めします。 |
| **マイクロソフト混合 (C++ /CLR) の最小規則** | これらの規則は、共通言語ランタイムをサポートする C++ プロジェクトの最も重大な問題に焦点を当てています。 これらの問題には、潜在的なセキュリティ ホール、アプリケーションのクラッシュ、その他の重要なロジックと設計エラーが含まれます。 共通言語ランタイムをサポートする C++ プロジェクト用に作成するカスタム規則セットには、この規則セットを含めすることをお勧めします。 |
| **マイクロソフト混合 (C++ /CLR) 推奨ルール** | これらの規則は、共通言語ランタイムをサポートする C++ プロジェクトの最も一般的で重大な問題に焦点を当てています。 これらの問題には、潜在的なセキュリティ ホール、アプリケーションのクラッシュ、その他の重要なロジックと設計エラーが含まれます。 このルールセットは、Visual Studio プロフェッショナル エディション以降で使用するために設計されています。 |
| **マイクロソフト のセキュリティルール** | この規則セットには、Microsoft のセキュリティ規則がすべて含まれます。 セキュリティ問題の検出範囲を最大化するには、この規則セットを使用してください。 |

すべてのルールを含めるには::

| ルール セット | 説明 |
|--|--|
| **マイクロソフトすべてのルール** | この規則セットにはすべての規則が含まれます。 この規則セットを実行すると、多数の警告が報告される可能性があります。 この規則セットは、コード内のすべての問題を全体的に把握する場合に使用してください。 より焦点を絞ったルール セットのうち、プロジェクトに対して実行するのに最も適したルール セットを決定するのに役立ちます。 |

## <a name="run-code-analysis"></a>コード分析の実行

[プロジェクトのプロパティ] ダイアログの [**コード分析**] ページでは、プロジェクトをビルドするたびに実行するようにコード分析を構成できます。 また、手動でコード分析を実行することもできます。

ソリューションでコード分析を実行するには

- [**ビルド**] メニューの [**ソリューションでコード分析を実行**] をクリックします。

プロジェクトでコード分析を実行するには

1. ソリューション エクスプローラーで、プロジェクトの名前を選択します。

1. [**ビルド**] メニューの [*プロジェクト名***でコード分析を実行**] をクリックします。

ファイルに対してコード分析を実行するには、次の手順に従います。

1. ソリューション エクスプローラーで、ファイルの名前を選択します。

1. [**ビルド**] メニューの [**ファイルでコード分析を実行]** を選択するか **、Ctrl キーを押しながら Shift キーを押しながら Alt キーを押しながら F7**キーを押します。

   プロジェクトまたはソリューションがコンパイルされ、コード分析が実行されます。 結果は[エラー一覧]ウィンドウに表示されます。

## <a name="analyze-and-resolve-code-analysis-warnings"></a>コード分析の警告の分析と解決

[エラー一覧] ウィンドウには、検出されたコード分析の警告が一覧表示されます。 結果はテーブルに表示されます。 特定の警告に関する詳細情報がある場合、最初の列には拡張コントロールが含まれます。 問題に関する追加情報を表示するには、このオプションを選択します。 可能な場合は、コード分析に行番号と、警告の原因となった分析ロジックが表示されます。

問題の解決策を含む警告の詳細については、[コード] 列で警告 ID を選択して対応するオンライン ヘルプ記事を表示します。

警告をダブルクリックして、Visual Studio のコード エディターで警告の原因となったコード行にカーソルを移動します。 または、選択した警告の [Enter] を押します。

問題を理解した後は、コード内で解決できます。 次に、コード分析を再実行して、警告がエラー一覧に表示されなくなったことを確認します。

## <a name="create-work-items-for-code-analysis-warnings"></a>コード分析の警告の作業項目を作成する

作業項目トラッキング機能を使用して、Visual Studio 内からバグをログに記録できます。 この機能を使用するには、Azure DevOps サーバー (以前のチーム ファンデーション サーバー) のインスタンスに接続する必要があります。

### <a name="to-create-a-work-item-for-one-or-more-cc-code-warnings"></a>1 つ以上の C/C++ コード警告用に作業項目を作成するには

1. [エラー一覧] で、警告を展開して選択します。

1. 警告のショートカット メニューで [**作業項目の作成**] をクリックし、作業項目の種類を選択します。

1. 選択された警告に対して作業項目が 1 つ作成され、IDE のドキュメント ウィンドウに作業項目が表示されます。

1. 追加情報を追加し、[**作業項目の保存**] を選択します。

## <a name="search-and-filter-code-analysis-results"></a>コード分析結果の検索とフィルター

警告メッセージの長い一覧の検索と、複数のプロジェクトから成るソリューションの警告をフィルター処理できます。

- **警告をタイトルまたは警告 ID でフィルタするには**、 [ 検索エラー一覧 ] ボックスにキーワードを入力します。

- **重大度で警告をフィルタするには**: 既定では、コード分析メッセージには重大度が **[警告**] に設定されています。 1 つ以上のメッセージの重大度を、カスタムルールセットの**エラー**として割り当てることができます。 [**エラー一覧**] の [**重大度**] 列で、ドロップダウン矢印を選択し、次にフィルタ アイコンを選択します。 [**警告]** または **[エラー]** を選択すると、それぞれの重大度が割り当てられているメッセージのみが表示されます。 [**すべて選択]** を選択すると、すべてのメッセージが表示されます。

## <a name="see-also"></a>関連項目

- [C/C++ のコード分析](../code-quality/code-analysis-for-c-cpp-overview.md)
