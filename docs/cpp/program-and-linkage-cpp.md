---
title: 翻訳単位とリンケージ (C++)
ms.date: 12/11/2019
ms.assetid: a6493ba0-24e2-4c89-956e-9da1dea660cb
ms.openlocfilehash: 791ec53d4df863b218db463f2b9b9401bf6f466d
ms.sourcegitcommit: c123cc76bb2b6c5cde6f4c425ece420ac733bf70
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/14/2020
ms.locfileid: "81374323"
---
# <a name="translation-units-and-linkage"></a>翻訳単位とリンケージ

C++ プログラムでは、変数や関数名などの*シンボル*をスコープ内で何度でも宣言できますが、定義できるのは 1 回だけです。 このルールは、"1 つの定義規則" (ODR) です。 *宣言*は、プログラムに名前を導入する (または再導入する) 。 *定義*は名前を導入します。 名前が変数を表す場合、定義は明示的に変数を初期化します。 *関数定義*は、署名と関数本体で構成されます。 クラス定義は、クラス名の後に、すべてのクラス メンバーをリストするブロックで構成されます。 (メンバー関数の本体は、別のファイルで別々に定義することもできます)。

次の例は、いくつかの宣言を示しています。

```cpp
int i;
int f(int x);
class C;
```

次の例は、いくつかの定義を示しています。

```cpp
int i{42};
int f(int x){ return x * i; }
class C {
public:
   void DoSomething();
};
```

プログラムは 1 つ以上の*翻訳単位*で構成されます。 翻訳単位は、実装ファイルと、それが直接または間接的に含まれるすべてのヘッダーで構成されます。 実装ファイルのファイル拡張子は通常*cpp*または*cxx*です。 ヘッダー ファイルの拡張子は、通常*h*または*hpp*です。 各翻訳単位は、コンパイラによって個別にコンパイルされます。 コンパイルが完了すると、リンカーはコンパイル済みの翻訳単位を 1 つの*プログラム*にマージします。 ODR ルールの違反は、通常リンカー エラーとして表示されます。 リンカー エラーは、同じ名前が異なる翻訳単位で 2 つの異なる定義を持つ場合に発生します。

一般に、複数のファイルに変数を表示する最善の方法は、変数をヘッダー ファイルに入れる方法です。 次に、宣言を必要とするすべての*cpp*ファイルに #include ディレクティブを追加します。 ヘッダーの内容の周囲に*包含ガード*を追加すると、宣言する名前が一度だけ定義されるようにします。

C++ 20 では、[モジュール](modules-cpp.md)はヘッダー ファイルの改良された代替手段として導入されています。

*場合によっては、cpp*ファイルでグローバル変数またはクラスを宣言する必要があります。 このような場合は、コンパイラに名前のリン*ケージ*の種類を知る方法が必要です。 リンケージのタイプは、オブジェクトの名前を 1 つのファイルだけに適用するか、すべてのファイルに適用するかを指定します。 リンケージの概念はグローバル名にのみ適用されます。 リンケージの概念は、スコープ内で宣言された名前には適用されません。 スコープは、関数またはクラス定義など、一連の囲む中かっこで指定されます。

## <a name="external-vs-internal-linkage"></a>外部リンケージと内部リンケージ

*自由関数*は、グローバルスコープまたは名前空間スコープで定義される関数です。 非 const グローバル変数とフリー関数は、デフォルトで*外部リンケージ*を持ちます。これらは、プログラム内の翻訳単位から表示されます。 したがって、他のグローバルオブジェクトはその名前を持つ必要はありません。 *内部リンケージ*を持つシンボルまたは*リンケージなし*シンボルは、それが宣言されている翻訳単位内でのみ表示されます。 名前に内部リンケージがある場合、同じ名前が別の翻訳単位に存在する可能性があります。 クラス定義または関数本体で宣言された変数には、リンケージがありません。

グローバル名を**静的**として明示的に宣言することで、内部リンケージを強制的に持つことができます。 これにより、その可視性は、それが宣言されているのと同じ翻訳単位に制限されます。 このコンテキストでは、**静的**とは、ローカル変数に適用されたときとは異なる意味です。

次のオブジェクトには、既定で内部リンケージがあります。

- const オブジェクト
- 恒常オブジェクト
- typedef
- 名前空間スコープ内の静的オブジェクト

const オブジェクトに外部リンケージを与える場合は、それを**extern**として宣言し、値を代入します。

```cpp
extern const int value = 42;
```

詳細については[、extern](extern-cpp.md)を参照してください。

## <a name="see-also"></a>関連項目

[基本概念](../cpp/basic-concepts-cpp.md)
